var It=Object.defineProperty;var wt=(n,e,t)=>e in n?It(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var a=(n,e,t)=>(wt(n,typeof e!="symbol"?e+"":e,t),t),Q=(n,e,t)=>{if(!e.has(n))throw TypeError("Cannot "+t)};var u=(n,e,t)=>(Q(n,e,"read from private field"),t?t.call(n):e.get(n)),S=(n,e,t)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,t)},F=(n,e,t,o)=>(Q(n,e,"write to private field"),o?o.call(n,t):e.set(n,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();class Pt{constructor(e){a(this,"animationStartTime",0);a(this,"animationStartOffset",0);a(this,"networkDelay");a(this,"maxOffset");a(this,"offset",0);a(this,"parallax");a(this,"limitFingerDrag");this.networkDelay=e.networkDelay,this.maxOffset=e.targetOffset,this.parallax=e.parallax,this.limitFingerDrag=e.limitFingerDrag}startAnimating(e){this.animationStartTime=e,this.animationStartOffset=this.offset}pointerUp(e){return"success"}committed(){return performance.now()-this.animationStartTime>=this.networkDelay}}function Rt(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var it={exports:{}};(function(n){(function(){n.exports=e;function e(t,o,s,i){typeof s=="object"&&(i=s,s=!1),typeof i>"u"&&(i={});for(var l=0,f=0,v=0,y=0,c=t.length,d=0;d<c;++d)l+=t[d],f+=o[d],v+=t[d]*o[d],y+=t[d]*t[d];if(i.m=(v-l*f/c)/(y-l*l/c),i.b=f/c-i.m*l/c,s){for(var G=0,D=0;D<c;++D)G+=(o[D]-i.b-i.m*t[D])*(o[D]-i.b-i.m*t[D]);var K=c*y-l*l,J=1/(c-2)*G;i.bErr=Math.sqrt(J/K*y),i.mErr=Math.sqrt(c/K*J)}return function(Dt){return i.m*Dt+i.b}}})()})(it);var Ot=it.exports;const St=Rt(Ot);function r(){throw new Error("missing element")}function ot(n){let e={m:0};const t=n.map(s=>s.offset),o=n.map(s=>s.time);return St(o,t,!1,e),e.m,e.m}const W=10,Ft=10;class C{constructor(e){a(this,"mass",1);a(this,"initialVelocity",0);a(this,"dampingRatio");a(this,"undampedNaturalFrequency");a(this,"dampedNaturalFrequency");a(this,"lastNFrames");a(this,"name");const t=(2*Math.PI/e.frequencyResponse)**2*this.mass;this.undampedNaturalFrequency=Math.sqrt(t/this.mass),this.dampedNaturalFrequency=this.undampedNaturalFrequency*Math.sqrt(Math.abs(1-e.dampingRatio**2)),this.dampingRatio=e.dampingRatio,this.lastNFrames=[],this.name=e.name}position(e,t){const o=this.undampedNaturalFrequency*this.dampingRatio,s=this.dampedNaturalFrequency,i=(this.initialVelocity+o*e)/s,l=e,f=Math.exp(-o*t)*(i*Math.sin(s*t)+l*Math.cos(s*t));if(isNaN(f)||!isFinite(f))throw"Spring config invalid. Position: "+f;this.lastNFrames.push({offset:f,time:t});let v=!1;if(this.lastNFrames.length>W){this.lastNFrames.shift();let y=0;for(let c of this.lastNFrames)y+=c.offset*c.offset;v=y<Ft*W}return f<1&&(v=!0),{offset:f,done:v}}velocity(){return ot(this.lastNFrames)}}var w,h,P;class qt extends Pt{constructor(t){super(t);S(this,w,void 0);S(this,h,void 0);S(this,P,void 0);a(this,"lastRaf",null);a(this,"hasCommitted",!1);a(this,"hasAborted",!1);a(this,"pointerHistory",[]);a(this,"spring80FrequencyResponseInput",document.getElementById("spring80FrequencyResponse")??r());a(this,"spring80FrequencyResponseDisplay",document.getElementById("spring80FrequencyResponseDisplay")??r());a(this,"spring80DampingRatioInput",document.getElementById("spring80DampingRatio")??r());a(this,"spring80DampingRatioDisplay",document.getElementById("spring80DampingRatioDisplay")??r());a(this,"spring80FrequencyResponse",parseFloat(this.spring80FrequencyResponseInput.value));a(this,"spring80DampingRatio",parseFloat(this.spring80DampingRatioInput.value));this.animationStartOffset=0,this.spring80FrequencyResponseInput.addEventListener("input",()=>this.updateDisplays()),this.spring80DampingRatioInput.addEventListener("input",()=>this.updateDisplays()),F(this,w,new C({frequencyResponse:200,dampingRatio:.95,name:"100%"})),F(this,h,new C({frequencyResponse:this.spring80FrequencyResponse,dampingRatio:this.spring80DampingRatio,name:"80%"})),console.log(u(this,h)),F(this,P,new C({frequencyResponse:200,dampingRatio:.9,name:"0%"}))}updateDisplays(){console.log(this.spring80FrequencyResponseInput.value),this.spring80FrequencyResponseDisplay.innerHTML=this.spring80FrequencyResponseInput.value,this.spring80DampingRatioDisplay.innerHTML=this.spring80DampingRatioInput.value}advance(t){t=t,!this.hasCommitted&&this.committed()&&(this.startAnimating(this.lastRaf||t),this.hasCommitted=!0,u(this,w).initialVelocity=u(this,h).velocity());const o=t-this.animationStartTime;let s=null;return this.hasAborted?(s=u(this,P).position(this.animationStartOffset,o),this.offset=Math.max(s.offset,0)):this.hasCommitted?(s=u(this,w).position(this.maxOffset-this.animationStartOffset,o),this.offset=this.maxOffset-s.offset):(s=u(this,h).position(this.maxOffset*.8-this.animationStartOffset,o),this.offset=this.maxOffset*.8-s.offset),this.lastRaf=t,{done:s.done&&(this.hasCommitted||this.hasAborted),fgOffset:this.offset,bgOffset:this.fgToBgOffset(this.offset),hasCommitted:this.hasCommitted}}pointerMove(t){return this.offset=this.fingerDragAdd(this.offset,t.movementX),this.pointerHistory.push({offset:this.offset,time:t.timeStamp}),this.pointerHistory.length>10&&this.pointerHistory.shift(),this.offset<0&&(this.offset=0),{done:!1,fgOffset:this.offset,bgOffset:this.fgToBgOffset(this.offset),hasCommitted:!1}}fingerDragAdd(t,o){return this.limitFingerDrag?t+.8*o:t+o}fgToBgOffset(t){return this.parallax?.25*(t-this.maxOffset):0}pointerUp(t){const o=-Math.max(-ot(this.pointerHistory),-1.2);return console.log("offset",this.offset),console.log("velocity",o),(this.offset+o*100)/this.maxOffset<.3?(this.hasAborted=!0,u(this,P).initialVelocity=-o,"abort"):(u(this,h).initialVelocity=-o,"success")}}w=new WeakMap,h=new WeakMap,P=new WeakMap;let N=!1,B=!1,x=!1,H=!1,A=!1,U=!1,p=["resources/srp-cats.png","resources/srp-couches.png"],m=0;const at=document.body??r(),rt=document.getElementById("scrim")??r(),Lt=document.getElementById("globalProgress")??r(),lt=document.getElementById("attributedProgress")??r(),O=document.getElementById("networkDelayInput")??r(),Bt=document.getElementById("networkDelayDisplay")??r(),ct=document.getElementById("networkDelayLoadInput")??r(),xt=document.getElementById("networkDelayLoadDisplay")??r(),At=document.getElementById("zoomDisplay")??r(),Mt=document.getElementById("buttonTest")??r(),kt=document.getElementById("buttonSettings")??r(),mt=document.getElementById("settingsPanel")??r(),ft=document.getElementById("screenshots")??r();var et;const ut=((et=document.getElementById("frontimg"))==null?void 0:et.querySelector("img"))??r();var nt;const _=((nt=document.getElementById("midimg"))==null?void 0:nt.querySelector("img"))??r();var st;const V=((st=document.getElementById("backimg"))==null?void 0:st.querySelector("img"))??r(),Nt=document.getElementById("settingParallax")??r(),Tt=document.getElementById("settingLimitFingerDrag")??r(),$=document.getElementById("settingZoom")??r(),dt=document.getElementById("settingProgressAttribution")??r(),Ct=document.getElementById("settingUnloadHandler")??r();let E=lt,R=E.querySelector(".bar"),Ht="lightblue",g=0,Y=0,M=0,k=[50,100,300,600,1200,2500],I=1,T=1;function pt(){let n=k[parseInt(O.value)],e=k[parseInt(ct.value)];return Math.max(n,e)}function _t(n){var e;((e=n.target)==null?void 0:e.classList[0])!="screenshot"||N||(B=!0,b=z())}function gt(n){return .3+(1-n/document.documentElement.getBoundingClientRect().width)*.5}let q=!1;function Vt(n){if(!B)return;let e=b.pointerMove(n);document.documentElement.style.setProperty("--fg-offset",`${e.fgOffset}px`),document.documentElement.style.setProperty("--bg-offset",`${e.bgOffset}px`),document.documentElement.style.setProperty("--scrim",`${gt(e.fgOffset)}`),ht(e.fgOffset),$t(e.fgOffset)}function ht(n){let e=n/document.documentElement.getBoundingClientRect().width,t=1-(1-T)*e;document.documentElement.style.setProperty("--fg-scale",`${t}`)}function $t(n){if(n/document.documentElement.getBoundingClientRect().width>.5){if(!q){let t=document.documentElement.animate([{"--bg-scale":T}],{duration:100,fill:"forwards"});t.finished.then(()=>{t.commitStyles(),t.cancel()}),q=!0}}else if(q){let t=document.documentElement.animate([{"--bg-scale":I}],{duration:100,fill:"forwards"});t.finished.then(()=>{t.commitStyles(),t.cancel()}),q=!1}}function Ut(n){if(!B)return;if(B=!1,H=!1,b.pointerUp(n)=="abort")j(),x=!0;else if(Ct.checked){let t=document.documentElement.style.getPropertyValue("--fg-offset"),o=document.documentElement.style.getPropertyValue("--fg-scale"),s=document.documentElement.getBoundingClientRect().width*10/100,i=document.documentElement.animate([{"--fg-scale":1,"--fg-offset":s+"px"}],{duration:300,fill:"forwards"});i.finished.then(()=>{if(i.commitStyles(),i.cancel(),window.confirm("are you sure you want to leave this page?  It's very nice.")){let l=document.documentElement.animate([{"--fg-scale":o,"--fg-offset":t}],{duration:200,fill:"forwards"});l.finished.then(()=>{l.commitStyles(),l.cancel(),j(),tt().then(X)})}});return}tt().then(X)}function Zt(){let n=document.documentElement.animate([{"--fg-scale":T,"--bg-scale":1}],{duration:100,fill:"forwards"});n.finished.then(()=>{n.commitStyles(),n.cancel()})}function j(){let n=document.documentElement.animate([{"--fg-scale":1,"--bg-scale":I}],{duration:100,fill:"forwards"});n.finished.then(()=>{n.commitStyles(),n.cancel()})}function X(){U=!0,document.documentElement.animate([{"--scrim":0}],{duration:100}).finished.then(bt),A=!x,A?yt():Z()}function yt(){let n=performance.now();if(n>=M){Z();return}E.style.display="block",R.max=M-g,R.value=n-g,requestAnimationFrame(yt)}let b=z();vt();function Et(n,e){const t=b.advance(n);document.documentElement.style.setProperty("--fg-offset",`${t.fgOffset}px`),document.documentElement.style.setProperty("--bg-offset",`${t.bgOffset}px`),document.documentElement.style.setProperty("--scrim",`${gt(t.fgOffset)}`),ht(t.fgOffset),n-g>800&&(E.style.display="block"),t.hasCommitted&&!H&&(Zt(),H=!0),t.done?e():requestAnimationFrame(o=>{Et(o,e)})}function tt(){return N=!0,g=performance.now(),Y=g+parseFloat(O.value),M=g+pt(),console.log("start : "+g+" commit : "+Y+" load : "+M),b.startAnimating(g),new Promise(n=>{Et(performance.now(),n)})}function bt(){U=!1,document.documentElement.style.setProperty("--fg-offset","0px"),document.documentElement.style.setProperty("--vertical-offset","0px"),document.documentElement.style.setProperty("--scrim","0.0"),document.documentElement.style.setProperty("--bg-scale",I.toString()),document.documentElement.style.setProperty("--fg-scale","1.0"),x?(document.documentElement.style.setProperty("--main-background-color",Ht),x=!1):zt(),A||(N=!1)}function Z(){A=!1,E.style.display="none",R.removeAttribute("value"),R.removeAttribute("max"),U||(N=!1)}function vt(){bt(),Z()}function z(){return new qt({networkDelay:k[parseInt(O.value)],targetOffset:document.documentElement.getBoundingClientRect().width,parallax:!!Nt.checked,limitFingerDrag:!!Tt.checked})}function L(){Bt.innerHTML=k[parseInt(O.value)].toString(),xt.innerHTML=pt().toString(),I=parseInt($.value)/100,T=I+(1-I)/3,At.innerHTML=$.value.toString(),b.updateDisplays(),b=z(),vt()}function zt(){ut.src=_.src,_.src=V.src,V.src=p[m],m=(m+1)%p.length}function Gt(){mt.style.display="none",rt.style.display="block",ft.style.display="block",at.classList.add("test")}function Kt(){mt.style.display="flex",rt.style.display="none",ft.style.display="none",at.classList.remove("test")}function Jt(){dt.checked?E=lt:E=Lt,R=E.querySelector(".bar")}function Qt(){O.addEventListener("input",L),ct.addEventListener("input",L),$.addEventListener("input",L),Mt.addEventListener("click",Gt),kt.addEventListener("click",Kt),ut.src=p[m],m=(m+1)%p.length,_.src=p[m],m=(m+1)%p.length,V.src=p[m],m=(m+1)%p.length,dt.addEventListener("change",Jt),L(),window.addEventListener("pointerdown",_t),window.addEventListener("pointerup",Ut),window.addEventListener("pointermove",Vt)}onload=Qt;
