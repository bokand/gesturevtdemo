var mt=Object.defineProperty;var ft=(e,n,t)=>n in e?mt(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t;var a=(e,n,t)=>(ft(e,typeof n!="symbol"?n+"":n,t),t),G=(e,n,t)=>{if(!n.has(e))throw TypeError("Cannot "+t)};var f=(e,n,t)=>(G(e,n,"read from private field"),t?t.call(e):n.get(e)),P=(e,n,t)=>{if(n.has(e))throw TypeError("Cannot add the same private member more than once");n instanceof WeakSet?n.add(e):n.set(e,t)},R=(e,n,t,i)=>(G(e,n,"write to private field"),i?i.call(e,t):n.set(e,t),t);(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();class ut{constructor(n){a(this,"animationStartTime",0);a(this,"animationStartOffset",0);a(this,"networkDelay");a(this,"maxOffset");a(this,"offset",0);a(this,"parallax");a(this,"limitFingerDrag");this.networkDelay=n.networkDelay,this.maxOffset=n.targetOffset,this.parallax=n.parallax,this.limitFingerDrag=n.limitFingerDrag}startAnimating(n){this.animationStartTime=n,this.animationStartOffset=this.offset}pointerUp(n){return"success"}committed(){return performance.now()-this.animationStartTime>=this.networkDelay}}function dt(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var W={exports:{}};(function(e){(function(){e.exports=n;function n(t,i,s,o){typeof s=="object"&&(o=s,s=!1),typeof o>"u"&&(o={});for(var l=0,m=0,y=0,g=0,c=t.length,u=0;u<c;++u)l+=t[u],m+=i[u],y+=t[u]*i[u],g+=t[u]*t[u];if(o.m=(y-l*m/c)/(g-l*l/c),o.b=m/c-o.m*l/c,s){for(var $=0,E=0;E<c;++E)$+=(i[E]-o.b-o.m*t[E])*(i[E]-o.b-o.m*t[E]);var U=c*g-l*l,Z=1/(c-2)*$;o.bErr=Math.sqrt(Z/U*g),o.mErr=Math.sqrt(c/U*Z)}return function(ct){return o.m*ct+o.b}}})()})(W);var pt=W.exports;const gt=dt(pt);function r(){throw new Error("missing element")}function Y(e){let n={m:0};const t=e.map(s=>s.offset),i=e.map(s=>s.time);return gt(i,t,!1,n),n.m,n.m}const K=10,ht=10;class N{constructor(n){a(this,"mass",1);a(this,"initialVelocity",0);a(this,"dampingRatio");a(this,"undampedNaturalFrequency");a(this,"dampedNaturalFrequency");a(this,"lastNFrames");a(this,"name");const t=(2*Math.PI/n.frequencyResponse)**2*this.mass;this.undampedNaturalFrequency=Math.sqrt(t/this.mass),this.dampedNaturalFrequency=this.undampedNaturalFrequency*Math.sqrt(Math.abs(1-n.dampingRatio**2)),this.dampingRatio=n.dampingRatio,this.lastNFrames=[],this.name=n.name}position(n,t){const i=this.undampedNaturalFrequency*this.dampingRatio,s=this.dampedNaturalFrequency,o=(this.initialVelocity+i*n)/s,l=n,m=Math.exp(-i*t)*(o*Math.sin(s*t)+l*Math.cos(s*t));if(isNaN(m)||!isFinite(m))throw"Spring config invalid. Position: "+m;this.lastNFrames.push({offset:m,time:t});let y=!1;if(this.lastNFrames.length>K){this.lastNFrames.shift();let g=0;for(let c of this.lastNFrames)g+=c.offset*c.offset;y=g<ht*K}return m<1&&(y=!0),{offset:m,done:y}}velocity(){return Y(this.lastNFrames)}}var D,p,v;class yt extends ut{constructor(t){super(t);P(this,D,void 0);P(this,p,void 0);P(this,v,void 0);a(this,"lastRaf",null);a(this,"hasCommitted",!1);a(this,"hasAborted",!1);a(this,"pointerHistory",[]);a(this,"spring80FrequencyResponseInput",document.getElementById("spring80FrequencyResponse")??r());a(this,"spring80FrequencyResponseDisplay",document.getElementById("spring80FrequencyResponseDisplay")??r());a(this,"spring80DampingRatioInput",document.getElementById("spring80DampingRatio")??r());a(this,"spring80DampingRatioDisplay",document.getElementById("spring80DampingRatioDisplay")??r());a(this,"spring80FrequencyResponse",parseFloat(this.spring80FrequencyResponseInput.value));a(this,"spring80DampingRatio",parseFloat(this.spring80DampingRatioInput.value));this.animationStartOffset=0,this.spring80FrequencyResponseInput.addEventListener("input",()=>this.updateDisplays()),this.spring80DampingRatioInput.addEventListener("input",()=>this.updateDisplays()),R(this,D,new N({frequencyResponse:200,dampingRatio:.95,name:"100%"})),R(this,p,new N({frequencyResponse:this.spring80FrequencyResponse,dampingRatio:this.spring80DampingRatio,name:"80%"})),console.log(f(this,p)),R(this,v,new N({frequencyResponse:200,dampingRatio:.9,name:"0%"}))}updateDisplays(){console.log(this.spring80FrequencyResponseInput.value),this.spring80FrequencyResponseDisplay.innerHTML=this.spring80FrequencyResponseInput.value,this.spring80DampingRatioDisplay.innerHTML=this.spring80DampingRatioInput.value}advance(t){t=t,!this.hasCommitted&&this.committed()&&(this.startAnimating(this.lastRaf||t),this.hasCommitted=!0,f(this,D).initialVelocity=f(this,p).velocity());const i=t-this.animationStartTime;let s=null;return this.hasAborted?(s=f(this,v).position(this.animationStartOffset,i),this.offset=Math.max(s.offset,0)):this.hasCommitted?(s=f(this,D).position(this.maxOffset-this.animationStartOffset,i),this.offset=this.maxOffset-s.offset):(s=f(this,p).position(this.maxOffset*.8-this.animationStartOffset,i),this.offset=this.maxOffset*.8-s.offset),this.lastRaf=t,{done:s.done&&(this.hasCommitted||this.hasAborted),fgOffset:this.offset,bgOffset:this.fgToBgOffset(this.offset),hasCommitted:this.hasCommitted}}pointerMove(t){return this.offset=this.fingerDragAdd(this.offset,t.movementX),this.pointerHistory.push({offset:this.offset,time:t.timeStamp}),this.pointerHistory.length>10&&this.pointerHistory.shift(),this.offset<0&&(this.offset=0),{done:!1,fgOffset:this.offset,bgOffset:this.fgToBgOffset(this.offset),hasCommitted:!1}}fingerDragAdd(t,i){return this.limitFingerDrag?t+.8*i:t+i}fgToBgOffset(t){return this.parallax?.25*(t-this.maxOffset):0}pointerUp(t){const i=-Math.max(-Y(this.pointerHistory),-1.2);return console.log("offset",this.offset),console.log("velocity",i),(this.offset+i*100)/this.maxOffset<.3?(this.hasAborted=!0,f(this,v).initialVelocity=-i,"abort"):(f(this,p).initialVelocity=-i,"success")}}D=new WeakMap,p=new WeakMap,v=new WeakMap;let L,z,M=!1,S=!1,q=!1,C=!1,B=!1,T=!1;const j=document.getElementById("scrim")??r(),H=document.getElementById("progress")??r(),J=document.getElementById("progressContainer")??r(),A=document.getElementById("progress_bar")??r(),w=document.getElementById("networkDelayInput")??r(),Et=document.getElementById("networkDelayDisplay")??r(),X=document.getElementById("networkDelayLoadInput")??r(),Dt=document.getElementById("networkDelayLoadDisplay")??r(),vt=document.getElementById("settingLoadProgressBar")??r(),bt=document.getElementById("settingParallax")??r(),wt=document.getElementById("settingLimitFingerDrag")??r(),b=document.getElementById("settingZoom")??r(),Pt=document.getElementById("settingBackground")??r(),tt=document.getElementById("settingProgressAttribution")??r();let et="lightblue",d=0,Q=0,x=0,k=[50,100,300,600,1200,2500],I=100;function Rt(){I=I+1;const e=(I*185852+1)%34359738337/34359738337;return"#"+Math.floor(e*16777215).toString(16)}function Ot(){return Pt.checked?"white":Rt()}function nt(){let e=k[parseInt(w.value)],n=k[parseInt(X.value)];return Math.max(e,n)}function Ft(e){var n;((n=e.target)==null?void 0:n.id)!=""||M||(S=!0,h=V(),z=document.startViewTransition(),z.ready.then(()=>{et=document.documentElement.style.getPropertyValue("--main-background-color"),document.documentElement.style.setProperty("--main-background-color",Ot()),L=document.documentElement.animate({},{duration:0,pseudoElement:"::view-transition-new(root)"}),L.pause(),j.style.display="block"}))}function st(e){return .3+(1-e/document.documentElement.getBoundingClientRect().width)*.5}let O=!1;function It(e){if(!S)return;let n=h.pointerMove(e);document.documentElement.style.setProperty("--fg-offset",`${n.fgOffset}px`),document.documentElement.style.setProperty("--bg-offset",`${n.bgOffset}px`),document.documentElement.style.setProperty("--scrim",`${st(n.fgOffset)}`),it(n.fgOffset),Lt(n.fgOffset)}function it(e){if(b.checked){let t=1-.1*(e/document.documentElement.getBoundingClientRect().width);document.documentElement.style.setProperty("--fg-scale",`${t}`)}}function Lt(e){if(b.checked){if(e/document.documentElement.getBoundingClientRect().width>.5){if(!O){let t=document.documentElement.animate([{"--bg-scale":.9}],{duration:100,fill:"forwards"});t.finished.then(()=>{t.commitStyles(),t.cancel()}),O=!0}}else if(O){let t=document.documentElement.animate([{"--bg-scale":.8}],{duration:100,fill:"forwards"});t.finished.then(()=>{t.commitStyles(),t.cancel()}),O=!1}}}function St(e){if(!S)return;S=!1,C=!1,h.pointerUp(e)=="abort"&&(Bt(),q=!0,I--),xt().then(At)}function qt(){if(b.checked){let e=document.documentElement.animate([{"--fg-scale":.9,"--bg-scale":1}],{duration:100,fill:"forwards"});e.finished.then(()=>{e.commitStyles(),e.cancel()})}}function Bt(){if(b.checked){let e=document.documentElement.animate([{"--fg-scale":1,"--bg-scale":.8}],{duration:100,fill:"forwards"});e.finished.then(()=>{e.commitStyles(),e.cancel()})}}function At(){T=!0,document.documentElement.animate([{"--scrim":0}],{duration:100}).finished.then(rt),B=!!vt.checked&&!q,B?ot():_()}function ot(){let e=performance.now();if(e>=x){_();return}H.style.display="block",A.max=x-d,A.value=e-d,requestAnimationFrame(ot)}let h=V();lt();function at(e,n){const t=h.advance(e);document.documentElement.style.setProperty("--fg-offset",`${t.fgOffset}px`),document.documentElement.style.setProperty("--bg-offset",`${t.bgOffset}px`),document.documentElement.style.setProperty("--scrim",`${st(t.fgOffset)}`),it(t.fgOffset),e-d>800&&(H.style.display="block"),t.hasCommitted&&!C&&(qt(),C=!0),t.done?n():requestAnimationFrame(i=>{at(i,n)})}function xt(){return M=!0,d=performance.now(),Q=d+parseFloat(w.value),x=d+nt(),console.log("start : "+d+" commit : "+Q+" load : "+x),h.startAnimating(d),new Promise(e=>{at(performance.now(),e)})}function rt(){T=!1,document.documentElement.style.setProperty("--fg-offset","0px"),document.documentElement.style.setProperty("--vertical-offset","0px"),document.documentElement.style.setProperty("--scrim","0.0"),document.documentElement.style.setProperty("--bg-scale",b.checked?"0.8":"1.0"),document.documentElement.style.setProperty("--fg-scale","1.0"),q&&(document.documentElement.style.setProperty("--main-background-color",et),q=!1),L&&L.play(),j.style.display="none",B||(M=!1)}function _(){B=!1,H.style.display="none",A.removeAttribute("value"),A.removeAttribute("max"),T||(M=!1)}function lt(){rt(),_()}function V(){return new yt({networkDelay:k[parseInt(w.value)],targetOffset:document.documentElement.getBoundingClientRect().width,parallax:!!bt.checked,limitFingerDrag:!!wt.checked})}function F(){Et.innerHTML=k[parseInt(w.value)].toString(),Dt.innerHTML=nt().toString(),h.updateDisplays(),h=V(),lt()}function kt(){tt.checked?J.classList.add("attributed"):J.classList.remove("attributed")}function Mt(){w.addEventListener("input",F),X.addEventListener("input",F),b.addEventListener("change",F),tt.addEventListener("change",kt),F(),window.addEventListener("pointerdown",Ft),window.addEventListener("pointerup",St),window.addEventListener("pointermove",It)}onload=Mt;
