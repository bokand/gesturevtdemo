var X=Object.defineProperty;var tt=(n,e,t)=>e in n?X(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var a=(n,e,t)=>(tt(n,typeof e!="symbol"?e+"":e,t),t),H=(n,e,t)=>{if(!e.has(n))throw TypeError("Cannot "+t)};var m=(n,e,t)=>(H(n,e,"read from private field"),t?t.call(n):e.get(n)),D=(n,e,t)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,t)},b=(n,e,t,i)=>(H(n,e,"write to private field"),i?i.call(n,t):e.set(n,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();class et{constructor(e){a(this,"animationStartTime",0);a(this,"animationStartOffset",0);a(this,"networkDelay");a(this,"maxOffset");a(this,"offset",0);a(this,"parallax");a(this,"limitFingerDrag");this.networkDelay=e.networkDelay,this.maxOffset=e.targetOffset,this.parallax=e.parallax,this.limitFingerDrag=e.limitFingerDrag}startAnimating(e){this.animationStartTime=e,this.animationStartOffset=this.offset}pointerUp(e){return"success"}committed(){return performance.now()-this.animationStartTime>=this.networkDelay}}function nt(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var U={exports:{}};(function(n){(function(){n.exports=e;function e(t,i,s,o){typeof s=="object"&&(o=s,s=!1),typeof o>"u"&&(o={});for(var l=0,c=0,g=0,p=0,f=t.length,u=0;u<f;++u)l+=t[u],c+=i[u],g+=t[u]*i[u],p+=t[u]*t[u];if(o.m=(g-l*c/f)/(p-l*l/f),o.b=c/f-o.m*l/f,s){for(var k=0,y=0;y<f;++y)k+=(i[y]-o.b-o.m*t[y])*(i[y]-o.b-o.m*t[y]);var C=f*p-l*l,T=1/(f-2)*k;o.bErr=Math.sqrt(T/C*p),o.mErr=Math.sqrt(f/C*T)}return function(j){return o.m*j+o.b}}})()})(U);var st=U.exports;const it=nt(st);function r(){throw new Error("missing element")}function Z(n){let e={m:0};const t=n.map(s=>s.offset),i=n.map(s=>s.time);return it(i,t,!1,e),e.m,e.m}const _=10,ot=10;class q{constructor(e){a(this,"mass",1);a(this,"initialVelocity",0);a(this,"dampingRatio");a(this,"undampedNaturalFrequency");a(this,"dampedNaturalFrequency");a(this,"lastNFrames");a(this,"name");const t=(2*Math.PI/e.frequencyResponse)**2*this.mass;this.undampedNaturalFrequency=Math.sqrt(t/this.mass),this.dampedNaturalFrequency=this.undampedNaturalFrequency*Math.sqrt(Math.abs(1-e.dampingRatio**2)),this.dampingRatio=e.dampingRatio,this.lastNFrames=[],this.name=e.name}position(e,t){const i=this.undampedNaturalFrequency*this.dampingRatio,s=this.dampedNaturalFrequency,o=(this.initialVelocity+i*e)/s,l=e,c=Math.exp(-i*t)*(o*Math.sin(s*t)+l*Math.cos(s*t));if(isNaN(c)||!isFinite(c))throw"Spring config invalid. Position: "+c;this.lastNFrames.push({offset:c,time:t});let g=!1;if(this.lastNFrames.length>_){this.lastNFrames.shift();let p=0;for(let f of this.lastNFrames)p+=f.offset*f.offset;g=p<ot*_}return c<1&&(g=!0),{offset:c,done:g}}velocity(){return Z(this.lastNFrames)}}var E,d,R;class at extends et{constructor(t){super(t);D(this,E,void 0);D(this,d,void 0);D(this,R,void 0);a(this,"lastRaf",null);a(this,"hasCommitted",!1);a(this,"hasAborted",!1);a(this,"pointerHistory",[]);a(this,"spring80FrequencyResponseInput",document.getElementById("spring80FrequencyResponse")??r());a(this,"spring80FrequencyResponseDisplay",document.getElementById("spring80FrequencyResponseDisplay")??r());a(this,"spring80DampingRatioInput",document.getElementById("spring80DampingRatio")??r());a(this,"spring80DampingRatioDisplay",document.getElementById("spring80DampingRatioDisplay")??r());a(this,"spring80FrequencyResponse",parseFloat(this.spring80FrequencyResponseInput.value));a(this,"spring80DampingRatio",parseFloat(this.spring80DampingRatioInput.value));this.animationStartOffset=0,this.spring80FrequencyResponseInput.addEventListener("input",()=>this.updateDisplays()),this.spring80DampingRatioInput.addEventListener("input",()=>this.updateDisplays()),b(this,E,new q({frequencyResponse:200,dampingRatio:.95,name:"100%"})),b(this,d,new q({frequencyResponse:this.spring80FrequencyResponse,dampingRatio:this.spring80DampingRatio,name:"80%"})),console.log(m(this,d)),b(this,R,new q({frequencyResponse:200,dampingRatio:.9,name:"0%"}))}updateDisplays(){console.log(this.spring80FrequencyResponseInput.value),this.spring80FrequencyResponseDisplay.innerHTML=this.spring80FrequencyResponseInput.value,this.spring80DampingRatioDisplay.innerHTML=this.spring80DampingRatioInput.value}advance(t){t=t,!this.hasCommitted&&this.committed()&&(this.startAnimating(this.lastRaf||t),this.hasCommitted=!0,m(this,E).initialVelocity=m(this,d).velocity());const i=t-this.animationStartTime;let s=null;return this.hasAborted?(s=m(this,R).position(this.animationStartOffset,i),this.offset=Math.max(s.offset,0)):this.hasCommitted?(s=m(this,E).position(this.maxOffset-this.animationStartOffset,i),this.offset=this.maxOffset-s.offset):(s=m(this,d).position(this.maxOffset*.8-this.animationStartOffset,i),this.offset=this.maxOffset*.8-s.offset),this.lastRaf=t,{done:s.done&&(this.hasCommitted||this.hasAborted),fgOffset:this.offset,bgOffset:this.fgToBgOffset(this.offset),hasCommitted:this.hasCommitted}}pointerMove(t){return this.offset=this.fingerDragAdd(this.offset,t.movementX),this.pointerHistory.push({offset:this.offset,time:t.timeStamp}),this.pointerHistory.length>10&&this.pointerHistory.shift(),this.offset<0&&(this.offset=0),{done:!1,fgOffset:this.offset,bgOffset:this.fgToBgOffset(this.offset),hasCommitted:!1}}fingerDragAdd(t,i){return this.limitFingerDrag?t+.8*i:t+i}fgToBgOffset(t){return this.parallax?.25*(t-this.maxOffset):0}pointerUp(t){const i=-Math.max(-Z(this.pointerHistory),-1.2);return console.log("offset",this.offset),console.log("velocity",i),(this.offset+i*100)/this.maxOffset<.3?(this.hasAborted=!0,m(this,R).initialVelocity=-i,"abort"):(m(this,d).initialVelocity=-i,"success")}}E=new WeakMap,d=new WeakMap,R=new WeakMap;let w,V,B=!1,F=!1,S=!1,x=!1;const G=document.getElementById("scrim")??r(),K=document.getElementById("progress")??r(),$=document.getElementById("progressContainer")??r(),L=document.getElementById("networkDelayInput")??r(),rt=document.getElementById("networkDelayDisplay")??r(),lt=document.getElementById("settingParallax")??r(),ft=document.getElementById("settingLimitFingerDrag")??r(),O=document.getElementById("settingZoom")??r(),ct=document.getElementById("settingBackground")??r(),z=document.getElementById("settingProgressAttribution")??r();let J="lightblue",A=0,P=100;function mt(){P=P+1;const n=(P*185852+1)%34359738337/34359738337;return"#"+Math.floor(n*16777215).toString(16)}function ut(){return ct.checked?"white":mt()}function dt(n){var e;((e=n.target)==null?void 0:e.id)!=""||B||(F=!0,h=N(),V=document.startViewTransition(),V.ready.then(()=>{J=document.documentElement.style.getPropertyValue("--main-background-color"),document.documentElement.style.setProperty("--main-background-color",ut()),w=document.documentElement.animate({},{duration:0,pseudoElement:"::view-transition-new(root)"}),w.pause(),G.style.display="block"}))}function Q(n){return .3+(1-n/document.documentElement.getBoundingClientRect().width)*.5}let v=!1;function pt(n){if(!F)return;let e=h.pointerMove(n);document.documentElement.style.setProperty("--fg-offset",`${e.fgOffset}px`),document.documentElement.style.setProperty("--bg-offset",`${e.bgOffset}px`),document.documentElement.style.setProperty("--scrim",`${Q(e.fgOffset)}`),W(e.fgOffset),ht(e.fgOffset)}function W(n){if(O.checked){let t=1-.1*(n/document.documentElement.getBoundingClientRect().width);document.documentElement.style.setProperty("--fg-scale",`${t}`)}}function ht(n){if(O.checked){if(n/document.documentElement.getBoundingClientRect().width>.5){if(!v){let t=document.documentElement.animate([{"--bg-scale":.9}],{duration:100,fill:"forwards"});t.finished.then(()=>{t.commitStyles(),t.cancel()}),v=!0}}else if(v){let t=document.documentElement.animate([{"--bg-scale":.8}],{duration:100,fill:"forwards"});t.finished.then(()=>{t.commitStyles(),t.cancel()}),v=!1}}}function gt(n){if(!F)return;F=!1,x=!1,h.pointerUp(n)=="abort"&&(Et(),S=!0,P--),Rt().then(()=>{document.documentElement.animate([{"--scrim":0}],{duration:100}).finished.then(M)})}function yt(){if(O.checked){let n=document.documentElement.animate([{"--fg-scale":.9,"--bg-scale":1}],{duration:100,fill:"forwards"});n.finished.then(()=>{n.commitStyles(),n.cancel()})}}function Et(){if(O.checked){let n=document.documentElement.animate([{"--fg-scale":1,"--bg-scale":.8}],{duration:100,fill:"forwards"});n.finished.then(()=>{n.commitStyles(),n.cancel()})}}let h=N();M();function Y(n,e){const t=h.advance(n);document.documentElement.style.setProperty("--fg-offset",`${t.fgOffset}px`),document.documentElement.style.setProperty("--bg-offset",`${t.bgOffset}px`),document.documentElement.style.setProperty("--scrim",`${Q(t.fgOffset)}`),W(t.fgOffset),n-A>800&&(K.style.display="block"),t.hasCommitted&&!x&&(yt(),x=!0),t.done?e():requestAnimationFrame(i=>{Y(i,e)})}function Rt(){return B=!0,A=performance.now(),h.startAnimating(A),new Promise(n=>{Y(performance.now(),n)})}function M(){B=!1,document.documentElement.style.setProperty("--fg-offset","0px"),document.documentElement.style.setProperty("--vertical-offset","0px"),document.documentElement.style.setProperty("--scrim","0.0"),document.documentElement.style.setProperty("--bg-scale",O.checked?"0.8":"1.0"),document.documentElement.style.setProperty("--fg-scale","1.0"),S&&(document.documentElement.style.setProperty("--main-background-color",J),S=!1),w&&w.play(),G.style.display="none",K.style.display="none"}function N(){return new at({networkDelay:parseFloat(L.value),targetOffset:document.documentElement.getBoundingClientRect().width,parallax:!!lt.checked,limitFingerDrag:!!ft.checked})}function I(){rt.innerHTML=L.value,h.updateDisplays(),h=N(),M()}function Ot(){z.checked?$.classList.add("attributed"):$.classList.remove("attributed")}function Dt(){L.addEventListener("input",I),O.addEventListener("change",I),z.addEventListener("change",Ot),I(),window.addEventListener("pointerdown",dt),window.addEventListener("pointerup",gt),window.addEventListener("pointermove",pt)}onload=Dt;
