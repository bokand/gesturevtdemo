var $=Object.defineProperty;var G=(e,t,n)=>t in e?$(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var a=(e,t,n)=>(G(e,typeof t!="symbol"?t+"":t,n),n),A=(e,t,n)=>{if(!t.has(e))throw TypeError("Cannot "+n)};var f=(e,t,n)=>(A(e,t,"read from private field"),n?n.call(e):t.get(e)),w=(e,t,n)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,n)},v=(e,t,n,i)=>(A(e,t,"write to private field"),i?i.call(e,n):t.set(e,n),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();class Y{constructor(t){a(this,"animationStartTime",0);a(this,"animationStartOffset",0);a(this,"networkDelay");a(this,"maxOffset");a(this,"offset",0);this.networkDelay=t.networkDelay,this.maxOffset=t.targetOffset}startAnimating(t){this.animationStartTime=t,this.animationStartOffset=this.offset}pointerUp(t){}committed(){return performance.now()-this.animationStartTime>=this.networkDelay}}function K(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var k={exports:{}};(function(e){(function(){e.exports=t;function t(n,i,s,o){typeof s=="object"&&(o=s,s=!1),typeof o>"u"&&(o={});for(var r=0,m=0,g=0,d=0,l=n.length,u=0;u<l;++u)r+=n[u],m+=i[u],g+=n[u]*i[u],d+=n[u]*n[u];if(o.m=(g-r*m/l)/(d-r*r/l),o.b=m/l-o.m*r/l,s){for(var I=0,y=0;y<l;++y)I+=(i[y]-o.b-o.m*n[y])*(i[y]-o.b-o.m*n[y]);var L=l*d-r*r,b=1/(l-2)*I;o.bErr=Math.sqrt(b/L*d),o.mErr=Math.sqrt(l/L*b)}return function(U){return o.m*U+o.b}}})()})(k);var Z=k.exports;const z=K(Z);function N(){throw new Error("missing element")}function V(e){let t={m:0};const n=e.map(s=>s.offset),i=e.map(s=>s.time);return z(i,n,!1,t),t.m,console.log(e),console.log(t),t.m}const T=10,J=10;class P{constructor(t){a(this,"mass",1);a(this,"initialVelocity",0);a(this,"dampingRatio");a(this,"undampedNaturalFrequency");a(this,"dampedNaturalFrequency");a(this,"lastNFrames");a(this,"name");const n=(2*Math.PI/t.frequencyResponse)**2*this.mass;this.undampedNaturalFrequency=Math.sqrt(n/this.mass),this.dampedNaturalFrequency=this.undampedNaturalFrequency*Math.sqrt(Math.abs(1-t.dampingRatio**2)),this.dampingRatio=t.dampingRatio,this.lastNFrames=[],this.name=t.name}position(t,n){console.log("Start position: "+t),console.log("Time: "+n);const i=this.undampedNaturalFrequency*this.dampingRatio,s=this.dampedNaturalFrequency,o=(this.initialVelocity+i*t)/s,r=t,m=Math.exp(-i*n)*(o*Math.sin(s*n)+r*Math.cos(s*n));if(isNaN(m)||!isFinite(m))throw"Spring config invalid. Position: "+m;this.lastNFrames.push({offset:m,time:n});let g=!1;if(this.lastNFrames.length>T){this.lastNFrames.shift();let d=0;for(let l of this.lastNFrames)d+=l.offset*l.offset;g=d<J*T}return{offset:m,done:g}}velocity(){return V(this.lastNFrames)}}var p,c,S;class Q extends Y{constructor(n){super(n);w(this,p,void 0);w(this,c,void 0);w(this,S,void 0);a(this,"lastRaf",null);a(this,"hasCommitted",!1);a(this,"pointerHistory",[]);this.animationStartOffset=this.animationStartTime,v(this,p,new P({frequencyResponse:500,dampingRatio:.95,name:"100%"})),v(this,c,new P({frequencyResponse:600,dampingRatio:.7,name:"80%"})),v(this,S,new P({frequencyResponse:1e3,dampingRatio:.95,name:"0%"}))}updateDisplays(){}advance(n){n=n,!this.hasCommitted&&this.committed()&&(this.startAnimating(this.lastRaf||n),this.hasCommitted=!0,f(this,p).initialVelocity=f(this,c).velocity(),console.log("VELOCITY HANDOFF: "+f(this,c).velocity()));const i=n-this.animationStartTime;let s=null;return this.hasCommitted?(console.log(f(this,p)),s=f(this,p).position(this.maxOffset-this.animationStartOffset,i),this.offset=this.maxOffset-s.offset):(s=f(this,c).position(this.maxOffset*.8-this.animationStartOffset,i),console.log(f(this,c)),this.offset=this.maxOffset*.8-s.offset),console.log("Offset "+this.offset),this.lastRaf=n,{done:s.done&&this.hasCommitted,offset:this.offset}}pointerMove(n){return this.offset+=n.movementX,this.pointerHistory.push({offset:this.offset,time:n.timeStamp}),this.offset<0&&(this.offset=0),this.offset}pointerUp(n){f(this,c).initialVelocity=-V(this.pointerHistory),console.log("STARTING VELOCITY: "+f(this,c).initialVelocity)}}p=new WeakMap,c=new WeakMap,S=new WeakMap;let W=Q,E,x,q=!1,O=!1;const _=document.getElementById("scrim")??N(),F=document.getElementById("networkDelayInput")??N(),C=Array.from(document.querySelectorAll('input[name="mode"]')).map(e=>e),j=document.getElementById("networkDelayDisplay")??N();function X(){return"lightblue"}function tt(e){var t;((t=e.target)==null?void 0:t.id)!=""||q||(O=!0,h=M(),x=document.startViewTransition(),x.ready.then(()=>{document.documentElement.style.setProperty("--main-background-color",X()),E=document.documentElement.animate({},{duration:100,pseudoElement:"::view-transition-new(root)"}),E.pause(),_.style.display="block"}))}function H(e){return .3+(1-e/document.documentElement.getBoundingClientRect().width)*.5}function et(e){if(!O)return;let t=h.pointerMove(e);document.documentElement.style.setProperty("--offset",`${t}px`),document.documentElement.style.setProperty("--scrim",`${H(t)}`)}function nt(e){O&&(O=!1,h.pointerUp(e),st().then(()=>{document.documentElement.animate([{"--scrim":0}],{duration:100}).finished.then(D)}))}let h=M();D();function B(e,t){const n=h.advance(e);console.log(n),document.documentElement.style.setProperty("--offset",`${n.offset}px`),document.documentElement.style.setProperty("--scrim",`${H(n.offset)}`),n.done?t():requestAnimationFrame(i=>{B(i,t)})}function st(){return q=!0,h.startAnimating(performance.now()),new Promise(e=>{B(performance.now(),e)})}function D(){q=!1,document.documentElement.style.setProperty("--offset","0px"),document.documentElement.style.setProperty("--vertical-offset","0px"),document.documentElement.style.setProperty("--scrim","0.0"),E&&E.play(),_.style.display="none"}function M(){for(const e of C)e.checked&&parseInt(e.value);return new W({dragStartTime:performance.now(),networkDelay:parseFloat(F.value),targetOffset:document.documentElement.getBoundingClientRect().width})}function R(){j.innerHTML=F.value,h.updateDisplays(),h=M(),D()}function ot(){F.addEventListener("input",R);for(const e of C)e.addEventListener("click",R);R(),window.addEventListener("pointerdown",tt),window.addEventListener("pointerup",nt),window.addEventListener("pointermove",et)}onload=ot;
