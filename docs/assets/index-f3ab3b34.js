var wt=Object.defineProperty;var kt=(t,e,n)=>e in t?wt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var a=(t,e,n)=>(kt(t,typeof e!="symbol"?e+"":e,n),n),st=(t,e,n)=>{if(!e.has(t))throw TypeError("Cannot "+n)};var f=(t,e,n)=>(st(t,e,"read from private field"),n?n.call(t):e.get(t)),F=(t,e,n)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)},q=(t,e,n,i)=>(st(t,e,"write to private field"),i?i.call(t,n):e.set(t,n),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();class Rt{constructor(e){a(this,"animationStartTime",0);a(this,"animationStartOffset",0);a(this,"networkDelay");a(this,"maxOffset");a(this,"offset",0);a(this,"parallax");a(this,"fingerDragCurve");a(this,"boostVelocity");a(this,"targetStopPercent");a(this,"loadStart",0);this.networkDelay=e.networkDelay,this.maxOffset=e.targetOffset,this.parallax=e.parallax,this.fingerDragCurve=e.fingerDragCurve,this.boostVelocity=e.boostVelocity,this.targetStopPercent=e.targetStopPercent}startAnimating(e){this.loadStart=e,this.animationStartTime=e,this.animationStartOffset=this.offset}restartAnimating(e){this.animationStartTime=e,this.animationStartOffset=this.offset}pointerUp(e){return"success"}committed(e){return e-this.loadStart>=this.networkDelay}}function At(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var ft={exports:{}};(function(t){(function(){t.exports=e;function e(n,i,s,o){typeof s=="object"&&(o=s,s=!1),typeof o>"u"&&(o={});for(var l=0,c=0,g=0,d=0,m=n.length,u=0;u<m;++u)l+=n[u],c+=i[u],g+=n[u]*i[u],d+=n[u]*n[u];if(o.m=(g-l*c/m)/(d-l*l/m),o.b=c/m-o.m*l/m,s){for(var B=0,y=0;y<m;++y)B+=(i[y]-o.b-o.m*n[y])*(i[y]-o.b-o.m*n[y]);var A=m*d-l*l,nt=1/(m-2)*B;o.bErr=Math.sqrt(nt/A*d),o.mErr=Math.sqrt(m/A*nt)}return function(Ot){return o.m*Ot+o.b}}})()})(ft);var Ft=ft.exports;const qt=At(Ft);function r(){throw new Error("missing element")}function ut(t){let e={m:0};const n=t.map(s=>s.offset),i=t.map(s=>s.time);return qt(i,n,!1,e),e.m,e.m}const it=10,Lt=10;class G{constructor(e){a(this,"mass",1);a(this,"initialVelocity",0);a(this,"dampingRatio");a(this,"undampedNaturalFrequency");a(this,"dampedNaturalFrequency");a(this,"lastNFrames");a(this,"name");a(this,"overshootCurve",e=>e);const n=(2*Math.PI/e.frequencyResponse)**2*this.mass;this.undampedNaturalFrequency=Math.sqrt(n/this.mass),this.dampedNaturalFrequency=this.undampedNaturalFrequency*Math.sqrt(Math.abs(1-e.dampingRatio**2)),this.dampingRatio=e.dampingRatio,this.lastNFrames=[],this.name=e.name,e.overshootCurve&&(this.overshootCurve=e.overshootCurve)}position(e,n){const i=this.undampedNaturalFrequency*this.dampingRatio,s=this.dampedNaturalFrequency,o=(this.initialVelocity+i*e)/s,l=e;let c=Math.exp(-i*n)*(o*Math.sin(s*n)+l*Math.cos(s*n));if(c<0&&(c=this.overshootCurve(c)),isNaN(c)||!isFinite(c))throw"Spring config invalid. Position: "+c;this.lastNFrames.push({offset:c,time:n});let g=!1;if(this.lastNFrames.length>it){this.lastNFrames.shift();let d=0;for(let m of this.lastNFrames)d+=m.offset*m.offset;g=d<Lt*it}return c<1&&(g=!0),{offset:c,done:g}}velocity(){return ut(this.lastNFrames)}}var E,h,I;class xt extends Rt{constructor(n){super(n);F(this,E,void 0);F(this,h,void 0);F(this,I,void 0);a(this,"lastRaf",null);a(this,"hasCommitted",!1);a(this,"hasAborted",!1);a(this,"pointerHistory",[]);a(this,"spring80FrequencyResponseInput",document.getElementById("spring80FrequencyResponse")??r());a(this,"spring80FrequencyResponseDisplay",document.getElementById("spring80FrequencyResponseDisplay")??r());a(this,"spring80DampingRatioInput",document.getElementById("spring80DampingRatio")??r());a(this,"spring80DampingRatioDisplay",document.getElementById("spring80DampingRatioDisplay")??r());a(this,"hookAtInput",document.getElementById("hookAt")??r());a(this,"hookAtDisplay",document.getElementById("hookAtDisplay")??r());a(this,"spring80FrequencyResponse",parseFloat(this.spring80FrequencyResponseInput.value));a(this,"spring80DampingRatio",parseFloat(this.spring80DampingRatioInput.value));a(this,"hookAtPercent",parseFloat(this.hookAtInput.value));a(this,"hooked",!1);a(this,"pointerDownX",0);a(this,"dontBounceBackpageInput",document.getElementById("settingDontBounceBackpage")??r());a(this,"dontBounceBackpage",!!this.dontBounceBackpageInput.checked);this.animationStartOffset=0,this.spring80FrequencyResponseInput.addEventListener("input",()=>this.updateDisplays()),this.spring80DampingRatioInput.addEventListener("input",()=>this.updateDisplays()),this.hookAtInput.addEventListener("input",()=>this.updateDisplays()),this.dontBounceBackpageInput.addEventListener("input",()=>this.updateDisplays()),q(this,E,new G({frequencyResponse:200,dampingRatio:.95,name:"100%"})),q(this,h,new G({frequencyResponse:this.spring80FrequencyResponse,dampingRatio:this.spring80DampingRatio,name:"80%"})),q(this,I,new G({frequencyResponse:200,dampingRatio:.9,name:"0%"}))}updateDisplays(){this.spring80FrequencyResponseDisplay.innerHTML=this.spring80FrequencyResponseInput.value,this.spring80DampingRatioDisplay.innerHTML=this.spring80DampingRatioInput.value,this.hookAtDisplay.innerHTML=this.hookAtInput.value,this.dontBounceBackpage=!!this.dontBounceBackpageInput.checked}advance(n){n=n,!this.hasCommitted&&this.committed(n)&&(this.restartAnimating(this.lastRaf||n),this.hasCommitted=!0,this.hooked?f(this,E).initialVelocity=f(this,h).velocity():(this.hooked=!0,f(this,E).initialVelocity=f(this,h).initialVelocity),isNaN(f(this,E).initialVelocity)&&(f(this,E).initialVelocity=-2));const i=n-this.animationStartTime;let s=null;this.hooked?this.hasAborted?(s=f(this,I).position(this.animationStartOffset,i),this.offset=Math.max(s.offset,0)):this.hasCommitted?(s=f(this,E).position(this.maxOffset-this.animationStartOffset,i),this.offset=this.maxOffset-s.offset):(s=f(this,h).position(this.maxOffset*this.targetStopPercent-this.animationStartOffset,i),this.offset=this.maxOffset*this.targetStopPercent-s.offset):this.offset=this.animationStartOffset-i*f(this,h).initialVelocity,!this.hooked&&this.offset>this.maxOffset*this.hookAtPercent/100&&(this.restartAnimating(this.lastRaf||n),this.hooked=!0,this.animationStartOffset=this.offset);let o=s?s.done:!1,l=this.offset;return this.dontBounceBackpage&&(s=f(this,I).position(this.maxOffset-this.animationStartOffset,n-this.loadStart),l=this.maxOffset-Math.max(s.offset,0)),this.lastRaf=n,{done:o&&(this.hasCommitted||this.hasAborted),fgOffset:this.offset,bgOffset:this.fgToBgOffset(l),hasCommitted:this.hasCommitted}}pointerDown(n){this.pointerDownX=n.clientX}pointerMove(n){return this.offset=this.fingerDragCurve(n.clientX-this.pointerDownX),this.pointerHistory.push({offset:this.offset,time:n.timeStamp}),this.pointerHistory.length>10&&this.pointerHistory.shift(),this.offset<0&&(this.offset=0),{done:!1,fgOffset:this.offset,bgOffset:this.fgToBgOffset(this.offset),hasCommitted:!1}}fgToBgOffset(n){return this.parallax?.25*(n-this.maxOffset):0}setDefaultVelocity(){this.offset=this.maxOffset/4,f(this,h).initialVelocity=this.boostVelocity?-2.5:-1}pointerUp(n){let i=ut(this.pointerHistory);return this.boostVelocity&&(i*=3,i=Math.max(i,1)),i=Math.min(i,2.5),i=Math.max(i,.3),f(this,I).initialVelocity=-i,(this.offset+i*100)/this.maxOffset<.3||i<-.1?(this.hasAborted=!0,f(this,I).initialVelocity=-i,"abort"):(f(this,h).initialVelocity=-i,"success")}}E=new WeakMap,h=new WeakMap,I=new WeakMap;let H=!1,T=!1,k=!1,K=!1,w=!1,j=!1,b=[{main:"resources/srp-couches.png"},{main:"resources/pants-hemming-srp.png",precommit:"resources/pants-srp.png"},{main:"resources/srp-cats.png"},{main:"resources/banana-pie-srp.png"},{main:"resources/goo.gl-stock-a.png",precommit:"resources/goo.gl-stock-b.png"},{main:"resources/news-frontpage.png"},{main:"resources/news-article.png"}],p=0;const dt=document.body??r(),pt=document.getElementById("scrim")??r(),_=document.getElementById("globalProgress")??r(),ht=document.getElementById("attributedProgress")??r(),R=document.getElementById("networkDelayInput")??r(),Mt=document.getElementById("networkDelayDisplay")??r(),Ct=document.getElementById("zoomDisplay")??r(),Tt=document.getElementById("buttonTest")??r(),Vt=document.getElementById("buttonSettings")??r(),gt=document.getElementById("settingsPanel")??r(),yt=document.getElementById("screenshots")??r(),Nt=document.getElementById("targetStopDisplay")??r(),x=document.getElementById("dragCurve")??r();var lt;const V=((lt=document.getElementById("frontimg"))==null?void 0:lt.querySelector("img"))??r();var ct;const W=((ct=document.getElementById("midimg"))==null?void 0:ct.querySelector("img"))??r();var mt;const $=((mt=document.getElementById("midimgprecommit"))==null?void 0:mt.querySelector("img"))??r(),J=document.getElementById("settingZoom")??r(),vt=document.getElementById("settingProgressAttribution")??r(),Ht=document.getElementById("settingUnloadHandler")??r(),Et=document.getElementById("settingBoostVelocity")??r(),U=document.getElementById("settingTargetStop")??r(),_t=document.getElementById("settingFadeForeground")??r();let D=ht,Q=D.querySelector(".bar"),N=_.querySelector(".bar"),P=0,Y=0,$t=["P25","P50","P75","P90","P95","P99"],Z=[30,100,330,660,1e3,2360],O=1,z=1;function Ut(){let t=Z[parseInt(R.value)];return Math.min(Math.max(t+500,t*2),t+1e3)}function Zt(t){var e;((e=t.target)==null?void 0:e.classList[0])!="screenshot"||H&&!w||(k=!0,et(),T=!0,S=X(),S.pointerDown(t))}function bt(t){return .3+(1-t)*.5}let L=!1,M;function C(t){if(!T)return;M=t;let e=S.pointerMove(t),n=e.fgOffset/document.documentElement.getBoundingClientRect().width;document.documentElement.style.setProperty("--fg-offset",`${e.fgOffset}px`),document.documentElement.style.setProperty("--bg-offset",`${e.bgOffset}px`),document.documentElement.style.setProperty("--scrim",`${bt(n)}`),Dt(n),It(e.fgOffset),zt(e.fgOffset)}function It(t){let e=t/document.documentElement.getBoundingClientRect().width,n=1-(1-z)*e;document.documentElement.style.setProperty("--fg-scale",`${n}`)}function zt(t){if(t/document.documentElement.getBoundingClientRect().width>.5){if(!L){let n=document.documentElement.animate([{"--bg-scale":z}],{duration:100,fill:"forwards"});n.finished.then(()=>{n.commitStyles(),n.cancel()}),L=!0}}else if(L){let n=document.documentElement.animate([{"--bg-scale":O}],{duration:100,fill:"forwards"});n.finished.then(()=>{n.commitStyles(),n.cancel()}),L=!1}}function Xt(t){if(!T)return;if(T=!1,K=!1,S.pointerUp(t)=="abort")ot(),k=!0;else if(Ht.checked){let n=document.documentElement.style.getPropertyValue("--fg-offset"),i=document.documentElement.style.getPropertyValue("--fg-scale"),s=document.documentElement.animate([{"--fg-scale":1,"--fg-offset":"0px"}],{duration:300,fill:"forwards"});s.finished.then(()=>{if(s.commitStyles(),s.cancel(),window.confirm("are you sure you want to leave this page?  It's very nice.")){let o=document.documentElement.animate([{"--fg-scale":i,"--fg-offset":n}],{duration:200,fill:"forwards"});o.finished.then(()=>{o.commitStyles(),o.cancel(),ot(),rt().then(at)})}});return}rt().then(at)}function Gt(){let t=document.documentElement.animate([{"--fg-scale":z,"--bg-scale":1}],{duration:100,fill:"forwards"});t.finished.then(()=>{t.commitStyles(),t.cancel()});const e=$.animate({opacity:0},{duration:100,fill:"forwards"});e.finished.then(()=>{e.commitStyles(),e.cancel()})}function ot(){let t=document.documentElement.animate([{"--fg-scale":1,"--bg-scale":O}],{duration:100,fill:"forwards"});t.finished.then(()=>{t.commitStyles(),t.cancel()})}function at(){j=!0,document.documentElement.animate([{"--scrim":0}],{duration:100}).finished.then(Bt),w=!k,w?St():tt()}function St(){if(!w)return;let t=performance.now();if(t>=Y){tt();return}_.style.display="block",N.max=Y-P,N.value=t-P,requestAnimationFrame(St)}let S=X();et();function Pt(t,e){const n=S.advance(t);document.documentElement.style.setProperty("--fg-offset",`${n.fgOffset}px`),document.documentElement.style.setProperty("--bg-offset",`${n.bgOffset}px`);let i=n.fgOffset/document.documentElement.getBoundingClientRect().width;const s=bt(i);Dt(i);const o=s+.1*Math.sin((t-P)/200);document.documentElement.style.setProperty("--scrim",`${o}`),It(n.fgOffset),t-P>800&&(D.style.display="block"),n.hasCommitted&&!K&&(Gt(),K=!0),n.done?e():requestAnimationFrame(l=>{Pt(l,e)})}function rt(){return H=!0,P=performance.now(),Y=P+Ut(),S.startAnimating(P),new Promise(t=>{Pt(performance.now(),t)})}function Bt(){j=!1,document.documentElement.style.setProperty("--fg-offset","0px"),document.documentElement.style.setProperty("--vertical-offset","0px"),document.documentElement.style.setProperty("--scrim","0.0"),document.documentElement.style.setProperty("--bg-scale",O.toString()),document.documentElement.style.setProperty("--fg-scale","1.0"),$.style.opacity="1",k||Wt(),k=!1,w||(H=!1)}function tt(){w=!1,D.style.display="none",Q.removeAttribute("value"),Q.removeAttribute("max"),_.style.display="none",N.removeAttribute("value"),N.removeAttribute("max"),j||(H=!1)}function et(){tt(),Bt()}function X(){const t=document.documentElement.getBoundingClientRect().width,e=parseFloat(U.value);let n=i=>i;if(x.value=="linear80")n=i=>i*e;else if(x.value=="linearelastic")n=i=>{const s=i/t,o=.7;return s<o?i:(o+(s-o)/20)*t};else if(x.value=="snapto"){let i=0,s=0,o=-999,l=!1,c=-1,g=4,d=1,m=[];n=u=>{o==-999&&(o=u);let B=u-o;if(o=u,l&&(i<c*t?(i+=g,i>=c*t&&(i=c*t,l=!1,s=0)):i>c*t&&(i-=g,i<=c*t&&(i=c*t,l=!1,s=0))),l)return requestAnimationFrame(()=>{C(M)}),i;m.push(B),m.length>5&&m.shift();let y=0;for(let A of m)A*d<0&&y++;return y==m.length&&(d=-d,s=0),s+=B,c<e&&s/t>.1?(c=e,l=!0,requestAnimationFrame(()=>{C(M)})):c>0&&s/t<-.05?(c=0,l=!0,requestAnimationFrame(()=>{C(M)})):i+=.1*B,i}}return new xt({networkDelay:Z[parseInt(R.value)],targetOffset:t,parallax:!0,fingerDragCurve:n,boostVelocity:!!Et.checked,targetStopPercent:e})}function Kt(){let t=document.documentElement.getBoundingClientRect().width,e=X();e.setDefaultVelocity(),e.startAnimating(0);var n=document.getElementById("plot")??r();let i=n.width/1e3;n.height=t*i;var s=n.getContext("2d");if(!s)return;s.scale(i,i),s.lineWidth=3,s.strokeStyle="black",s.beginPath(),s.moveTo(0,0);for(var o=0;o<1e3;o++)s.lineTo(o,e.advance(o).fgOffset);s.stroke(),s.strokeStyle="red";let l=t*parseFloat(U.value);s.beginPath(),s.moveTo(0,l),s.lineTo(1e3,l),s.stroke(),s.strokeStyle="green";let c=Z[parseInt(R.value)];s.beginPath(),s.moveTo(c,0),s.lineTo(c,t),s.stroke()}function v(){let t=parseInt(R.value);Mt.innerHTML=$t[t]+"="+Z[t].toString(),O=parseInt(J.value)/100,z=O+(1-O)/3,Ct.innerHTML=J.value.toString(),Nt.innerHTML=`${100*parseFloat(U.value)}`,S.updateDisplays(),Kt(),S=X(),et()}function Dt(t){_t.checked&&(V.style.filter=`grayscale(${t})`)}function Wt(){V.style.filter="",V.src=W.src,W.src=b[p].main,$.src=b[p].precommit??"",p=(p+1)%b.length}function Jt(){gt.style.display="none",pt.style.display="block",yt.style.display="block",document.documentElement.style.setProperty("--main-background-color","#202020"),dt.classList.add("test")}function Qt(){gt.style.display="flex",pt.style.display="none",yt.style.display="none",document.documentElement.style.setProperty("--main-background-color","white"),dt.classList.remove("test")}function Yt(){vt.checked?D=ht:D=_,Q=D.querySelector(".bar")}function jt(){R.addEventListener("input",v),J.addEventListener("input",v),U.addEventListener("input",v),Et.addEventListener("input",v),x.addEventListener("input",v);let t=document.getElementById("spring80FrequencyResponse")??r(),e=document.getElementById("spring80DampingRatio")??r(),n=document.getElementById("hookAt")??r();t.addEventListener("input",v),e.addEventListener("input",v),n.addEventListener("input",v),Tt.addEventListener("click",Jt),Vt.addEventListener("click",Qt),V.src=b[p].main,p=(p+1)%b.length,W.src=b[p].main,$.src=b[p].precommit??"",p=(p+1)%b.length,vt.addEventListener("change",Yt),v(),window.addEventListener("pointerdown",Zt),window.addEventListener("pointerup",Xt),window.addEventListener("pointermove",C)}onload=jt;
