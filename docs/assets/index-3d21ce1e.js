var Dt=Object.defineProperty;var wt=(n,t,e)=>t in n?Dt(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var a=(n,t,e)=>(wt(n,typeof t!="symbol"?t+"":t,e),e),et=(n,t,e)=>{if(!t.has(n))throw TypeError("Cannot "+e)};var m=(n,t,e)=>(et(n,t,"read from private field"),e?e.call(n):t.get(n)),R=(n,t,e)=>{if(t.has(n))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(n):t.set(n,e)},A=(n,t,e,i)=>(et(n,t,"write to private field"),i?i.call(n,e):t.set(n,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function e(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=e(s);fetch(s.href,o)}})();class Ot{constructor(t){a(this,"animationStartTime",0);a(this,"animationStartOffset",0);a(this,"networkDelay");a(this,"maxOffset");a(this,"offset",0);a(this,"parallax");a(this,"fingerDragCurve");a(this,"boostVelocity");a(this,"targetStopPercent");a(this,"loadStart",0);this.networkDelay=t.networkDelay,this.maxOffset=t.targetOffset,this.parallax=t.parallax,this.fingerDragCurve=t.fingerDragCurve,this.boostVelocity=t.boostVelocity,this.targetStopPercent=t.targetStopPercent}startAnimating(t){this.loadStart=t,this.animationStartTime=t,this.animationStartOffset=this.offset}restartAnimating(t){this.animationStartTime=t,this.animationStartOffset=this.offset}pointerUp(t){return"success"}committed(t){return t-this.loadStart>=this.networkDelay}}function kt(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var ct={exports:{}};(function(n){(function(){n.exports=t;function t(e,i,s,o){typeof s=="object"&&(o=s,s=!1),typeof o>"u"&&(o={});for(var l=0,c=0,S=0,b=0,u=e.length,g=0;g<u;++g)l+=e[g],c+=i[g],S+=e[g]*i[g],b+=e[g]*e[g];if(o.m=(S-l*c/u)/(b-l*l/u),o.b=c/u-o.m*l/u,s){for(var Y=0,P=0;P<u;++P)Y+=(i[P]-o.b-o.m*e[P])*(i[P]-o.b-o.m*e[P]);var j=u*b-l*l,tt=1/(u-2)*Y;o.bErr=Math.sqrt(tt/j*b),o.mErr=Math.sqrt(u/j*tt)}return function(Bt){return o.m*Bt+o.b}}})()})(ct);var Rt=ct.exports;const At=kt(Rt);function r(){throw new Error("missing element")}function mt(n){let t={m:0};const e=n.map(s=>s.offset),i=n.map(s=>s.time);return At(i,e,!1,t),t.m,t.m}const nt=10,Ft=10;class U{constructor(t){a(this,"mass",1);a(this,"initialVelocity",0);a(this,"dampingRatio");a(this,"undampedNaturalFrequency");a(this,"dampedNaturalFrequency");a(this,"lastNFrames");a(this,"name");a(this,"overshootCurve",t=>t);const e=(2*Math.PI/t.frequencyResponse)**2*this.mass;this.undampedNaturalFrequency=Math.sqrt(e/this.mass),this.dampedNaturalFrequency=this.undampedNaturalFrequency*Math.sqrt(Math.abs(1-t.dampingRatio**2)),this.dampingRatio=t.dampingRatio,this.lastNFrames=[],this.name=t.name,t.overshootCurve&&(this.overshootCurve=t.overshootCurve)}position(t,e){const i=this.undampedNaturalFrequency*this.dampingRatio,s=this.dampedNaturalFrequency,o=(this.initialVelocity+i*t)/s,l=t;let c=Math.exp(-i*e)*(o*Math.sin(s*e)+l*Math.cos(s*e));if(c<0&&(c=this.overshootCurve(c)),isNaN(c)||!isFinite(c))throw"Spring config invalid. Position: "+c;this.lastNFrames.push({offset:c,time:e});let S=!1;if(this.lastNFrames.length>nt){this.lastNFrames.shift();let b=0;for(let u of this.lastNFrames)b+=u.offset*u.offset;S=b<Ft*nt}return c<1&&(S=!0),{offset:c,done:S}}velocity(){return mt(this.lastNFrames)}}var h,d,v;class qt extends Ot{constructor(e){super(e);R(this,h,void 0);R(this,d,void 0);R(this,v,void 0);a(this,"lastRaf",null);a(this,"hasCommitted",!1);a(this,"hasAborted",!1);a(this,"pointerHistory",[]);a(this,"spring80FrequencyResponseInput",document.getElementById("spring80FrequencyResponse")??r());a(this,"spring80FrequencyResponseDisplay",document.getElementById("spring80FrequencyResponseDisplay")??r());a(this,"spring80DampingRatioInput",document.getElementById("spring80DampingRatio")??r());a(this,"spring80DampingRatioDisplay",document.getElementById("spring80DampingRatioDisplay")??r());a(this,"hookAtInput",document.getElementById("hookAt")??r());a(this,"hookAtDisplay",document.getElementById("hookAtDisplay")??r());a(this,"spring80FrequencyResponse",parseFloat(this.spring80FrequencyResponseInput.value));a(this,"spring80DampingRatio",parseFloat(this.spring80DampingRatioInput.value));a(this,"hookAtPercent",parseFloat(this.hookAtInput.value));a(this,"hooked",!1);a(this,"pointerDownX",0);a(this,"dontBounceBackpageInput",document.getElementById("settingDontBounceBackpage")??r());a(this,"dontBounceBackpage",!!this.dontBounceBackpageInput.checked);this.animationStartOffset=0,this.spring80FrequencyResponseInput.addEventListener("input",()=>this.updateDisplays()),this.spring80DampingRatioInput.addEventListener("input",()=>this.updateDisplays()),this.hookAtInput.addEventListener("input",()=>this.updateDisplays()),this.dontBounceBackpageInput.addEventListener("input",()=>this.updateDisplays()),A(this,h,new U({frequencyResponse:200,dampingRatio:.95,name:"100%"})),A(this,d,new U({frequencyResponse:this.spring80FrequencyResponse,dampingRatio:this.spring80DampingRatio,name:"80%"})),A(this,v,new U({frequencyResponse:200,dampingRatio:.9,name:"0%"}))}updateDisplays(){this.spring80FrequencyResponseDisplay.innerHTML=this.spring80FrequencyResponseInput.value,this.spring80DampingRatioDisplay.innerHTML=this.spring80DampingRatioInput.value,this.hookAtDisplay.innerHTML=this.hookAtInput.value,this.dontBounceBackpage=!!this.dontBounceBackpageInput.checked}advance(e){e=e,!this.hasCommitted&&this.committed(e)&&(this.restartAnimating(this.lastRaf||e),this.hasCommitted=!0,this.hooked?m(this,h).initialVelocity=m(this,d).velocity():(this.hooked=!0,m(this,h).initialVelocity=m(this,d).initialVelocity),isNaN(m(this,h).initialVelocity)&&(m(this,h).initialVelocity=-2));const i=e-this.animationStartTime;let s=null;this.hooked?this.hasAborted?(s=m(this,v).position(this.animationStartOffset,i),this.offset=Math.max(s.offset,0)):this.hasCommitted?(s=m(this,h).position(this.maxOffset-this.animationStartOffset,i),this.offset=this.maxOffset-s.offset):(s=m(this,d).position(this.maxOffset*this.targetStopPercent-this.animationStartOffset,i),this.offset=this.maxOffset*this.targetStopPercent-s.offset):this.offset=this.animationStartOffset-i*m(this,d).initialVelocity,!this.hooked&&this.offset>this.maxOffset*this.hookAtPercent/100&&(this.restartAnimating(this.lastRaf||e),this.hooked=!0,this.animationStartOffset=this.offset);let o=s?s.done:!1,l=this.offset;return this.dontBounceBackpage&&(s=m(this,v).position(this.maxOffset-this.animationStartOffset,e-this.loadStart),l=this.maxOffset-Math.max(s.offset,0)),this.lastRaf=e,{done:o&&(this.hasCommitted||this.hasAborted),fgOffset:this.offset,bgOffset:this.fgToBgOffset(l),hasCommitted:this.hasCommitted}}pointerDown(e){this.pointerDownX=e.clientX}pointerMove(e){return this.offset=this.fingerDragCurve(e.clientX-this.pointerDownX),this.pointerHistory.push({offset:this.offset,time:e.timeStamp}),this.pointerHistory.length>10&&this.pointerHistory.shift(),this.offset<0&&(this.offset=0),{done:!1,fgOffset:this.offset,bgOffset:this.fgToBgOffset(this.offset),hasCommitted:!1}}fgToBgOffset(e){return this.parallax?.25*(e-this.maxOffset):0}setDefaultVelocity(){this.offset=this.maxOffset/4,m(this,d).initialVelocity=this.boostVelocity?-2.5:-1}pointerUp(e){let i=mt(this.pointerHistory);return this.boostVelocity&&(i*=3,i=Math.max(i,1)),i=Math.min(i,2.5),i=Math.max(i,.3),m(this,v).initialVelocity=-i,(this.offset+i*100)/this.maxOffset<.3||i<-.1?(this.hasAborted=!0,m(this,v).initialVelocity=-i,"abort"):(m(this,d).initialVelocity=-i,"success")}}h=new WeakMap,d=new WeakMap,v=new WeakMap;let C=!1,L=!1,O=!1,Z=!1,w=!1,W=!1,y=[{main:"resources/srp-couches.png"},{main:"resources/pants-hemming-srp.png",precommit:"resources/pants-srp.png"},{main:"resources/srp-cats.png"},{main:"resources/banana-pie-srp.png"},{main:"resources/goo.gl-stock-a.png",precommit:"resources/goo.gl-stock-b.png"},{main:"resources/news-frontpage.png"},{main:"resources/news-article.png"}],f=0;const ut=document.body??r(),ft=document.getElementById("scrim")??r(),T=document.getElementById("globalProgress")??r(),dt=document.getElementById("attributedProgress")??r(),k=document.getElementById("networkDelayInput")??r(),Lt=document.getElementById("networkDelayDisplay")??r(),xt=document.getElementById("zoomDisplay")??r(),Mt=document.getElementById("buttonTest")??r(),Ct=document.getElementById("buttonSettings")??r(),pt=document.getElementById("settingsPanel")??r(),ht=document.getElementById("screenshots")??r(),Tt=document.getElementById("targetStopDisplay")??r(),q=document.getElementById("dragCurve")??r();var at;const x=((at=document.getElementById("frontimg"))==null?void 0:at.querySelector("img"))??r();var rt;const z=((rt=document.getElementById("midimg"))==null?void 0:rt.querySelector("img"))??r();var lt;const V=((lt=document.getElementById("midimgprecommit"))==null?void 0:lt.querySelector("img"))??r(),G=document.getElementById("settingZoom")??r(),gt=document.getElementById("settingProgressAttribution")??r(),Vt=document.getElementById("settingUnloadHandler")??r(),yt=document.getElementById("settingBoostVelocity")??r(),N=document.getElementById("settingTargetStop")??r(),Nt=document.getElementById("settingFadeForeground")??r();let B=dt,X=B.querySelector(".bar"),M=T.querySelector(".bar"),I=0,K=0,Ht=["P25","P50","P75","P90","P95","P99"],H=[30,100,330,660,1e3,2360],D=1,_=1;function _t(){let n=H[parseInt(k.value)];return Math.min(Math.max(n+500,n*2),n+1e3)}function $t(n){var t;((t=n.target)==null?void 0:t.classList[0])!="screenshot"||C&&!w||(O=!0,Q(),L=!0,E=$(),E.pointerDown(n))}function vt(n){return .3+(1-n)*.5}let F=!1;function Ut(n){if(!L)return;let t=E.pointerMove(n),e=t.fgOffset/document.documentElement.getBoundingClientRect().width;document.documentElement.style.setProperty("--fg-offset",`${t.fgOffset}px`),document.documentElement.style.setProperty("--bg-offset",`${t.bgOffset}px`),document.documentElement.style.setProperty("--scrim",`${vt(e)}`),Pt(e),Et(t.fgOffset),Zt(t.fgOffset)}function Et(n){let t=n/document.documentElement.getBoundingClientRect().width,e=1-(1-_)*t;document.documentElement.style.setProperty("--fg-scale",`${e}`)}function Zt(n){if(n/document.documentElement.getBoundingClientRect().width>.5){if(!F){let e=document.documentElement.animate([{"--bg-scale":_}],{duration:100,fill:"forwards"});e.finished.then(()=>{e.commitStyles(),e.cancel()}),F=!0}}else if(F){let e=document.documentElement.animate([{"--bg-scale":D}],{duration:100,fill:"forwards"});e.finished.then(()=>{e.commitStyles(),e.cancel()}),F=!1}}function zt(n){if(!L)return;if(L=!1,Z=!1,E.pointerUp(n)=="abort")st(),O=!0;else if(Vt.checked){let e=document.documentElement.style.getPropertyValue("--fg-offset"),i=document.documentElement.style.getPropertyValue("--fg-scale"),s=document.documentElement.animate([{"--fg-scale":1,"--fg-offset":"0px"}],{duration:300,fill:"forwards"});s.finished.then(()=>{if(s.commitStyles(),s.cancel(),window.confirm("are you sure you want to leave this page?  It's very nice.")){let o=document.documentElement.animate([{"--fg-scale":i,"--fg-offset":e}],{duration:200,fill:"forwards"});o.finished.then(()=>{o.commitStyles(),o.cancel(),st(),ot().then(it)})}});return}ot().then(it)}function Gt(){let n=document.documentElement.animate([{"--fg-scale":_,"--bg-scale":1}],{duration:100,fill:"forwards"});n.finished.then(()=>{n.commitStyles(),n.cancel()});const t=V.animate({opacity:0},{duration:100,fill:"forwards"});t.finished.then(()=>{t.commitStyles(),t.cancel()})}function st(){let n=document.documentElement.animate([{"--fg-scale":1,"--bg-scale":D}],{duration:100,fill:"forwards"});n.finished.then(()=>{n.commitStyles(),n.cancel()})}function it(){W=!0,document.documentElement.animate([{"--scrim":0}],{duration:100}).finished.then(St),w=!O,w?bt():J()}function bt(){if(!w)return;let n=performance.now();if(n>=K){J();return}T.style.display="block",M.max=K-I,M.value=n-I,requestAnimationFrame(bt)}let E=$();Q();function It(n,t){const e=E.advance(n);document.documentElement.style.setProperty("--fg-offset",`${e.fgOffset}px`),document.documentElement.style.setProperty("--bg-offset",`${e.bgOffset}px`);let i=e.fgOffset/document.documentElement.getBoundingClientRect().width;const s=vt(i);Pt(i);const o=s+.1*Math.sin((n-I)/200);document.documentElement.style.setProperty("--scrim",`${o}`),Et(e.fgOffset),n-I>800&&(B.style.display="block"),e.hasCommitted&&!Z&&(Gt(),Z=!0),e.done?t():requestAnimationFrame(l=>{It(l,t)})}function ot(){return C=!0,I=performance.now(),K=I+_t(),E.startAnimating(I),new Promise(n=>{It(performance.now(),n)})}function St(){W=!1,document.documentElement.style.setProperty("--fg-offset","0px"),document.documentElement.style.setProperty("--vertical-offset","0px"),document.documentElement.style.setProperty("--scrim","0.0"),document.documentElement.style.setProperty("--bg-scale",D.toString()),document.documentElement.style.setProperty("--fg-scale","1.0"),V.style.opacity="1",O||Kt(),O=!1,w||(C=!1)}function J(){w=!1,B.style.display="none",X.removeAttribute("value"),X.removeAttribute("max"),T.style.display="none",M.removeAttribute("value"),M.removeAttribute("max"),W||(C=!1)}function Q(){J(),St()}function $(){const n=document.documentElement.getBoundingClientRect().width,t=parseFloat(N.value);let e=i=>i;return q.value=="linear80"?e=i=>i*t:q.value=="linearelastic"?e=i=>{const s=i/n,o=.7;return s<o?i:(o+(s-o)/20)*n}:q.value=="snapto"&&(e=i=>{const s=i/n,o=.3,l=t/o;return s<o?i*l:(o*l+(s-o)/20)*n}),new qt({networkDelay:H[parseInt(k.value)],targetOffset:n,parallax:!0,fingerDragCurve:e,boostVelocity:!!yt.checked,targetStopPercent:t})}function Xt(){let n=document.documentElement.getBoundingClientRect().width,t=$();t.setDefaultVelocity(),t.startAnimating(0);var e=document.getElementById("plot")??r();let i=e.width/1e3;e.height=n*i;var s=e.getContext("2d");if(!s)return;s.scale(i,i),s.lineWidth=3,s.strokeStyle="black",s.beginPath(),s.moveTo(0,0);for(var o=0;o<1e3;o++)s.lineTo(o,t.advance(o).fgOffset);s.stroke(),s.strokeStyle="red";let l=n*parseFloat(N.value);s.beginPath(),s.moveTo(0,l),s.lineTo(1e3,l),s.stroke(),s.strokeStyle="green";let c=H[parseInt(k.value)];s.beginPath(),s.moveTo(c,0),s.lineTo(c,n),s.stroke()}function p(){let n=parseInt(k.value);Lt.innerHTML=Ht[n]+"="+H[n].toString(),D=parseInt(G.value)/100,_=D+(1-D)/3,xt.innerHTML=G.value.toString(),Tt.innerHTML=`${100*parseFloat(N.value)}`,E.updateDisplays(),Xt(),E=$(),Q()}function Pt(n){Nt.checked&&(x.style.filter=`grayscale(${n})`)}function Kt(){x.style.filter="",x.src=z.src,z.src=y[f].main,V.src=y[f].precommit??"",f=(f+1)%y.length}function Wt(){pt.style.display="none",ft.style.display="block",ht.style.display="block",document.documentElement.style.setProperty("--main-background-color","#202020"),ut.classList.add("test")}function Jt(){pt.style.display="flex",ft.style.display="none",ht.style.display="none",document.documentElement.style.setProperty("--main-background-color","white"),ut.classList.remove("test")}function Qt(){gt.checked?B=dt:B=T,X=B.querySelector(".bar")}function Yt(){k.addEventListener("input",p),G.addEventListener("input",p),N.addEventListener("input",p),yt.addEventListener("input",p),q.addEventListener("input",p);let n=document.getElementById("spring80FrequencyResponse")??r(),t=document.getElementById("spring80DampingRatio")??r(),e=document.getElementById("hookAt")??r();n.addEventListener("input",p),t.addEventListener("input",p),e.addEventListener("input",p),Mt.addEventListener("click",Wt),Ct.addEventListener("click",Jt),x.src=y[f].main,f=(f+1)%y.length,z.src=y[f].main,V.src=y[f].precommit??"",f=(f+1)%y.length,gt.addEventListener("change",Qt),p(),window.addEventListener("pointerdown",$t),window.addEventListener("pointerup",zt),window.addEventListener("pointermove",Ut)}onload=Yt;
