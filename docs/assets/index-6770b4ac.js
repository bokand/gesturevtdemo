var St=Object.defineProperty;var It=(n,t,e)=>t in n?St(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var a=(n,t,e)=>(It(n,typeof t!="symbol"?t+"":t,e),e),W=(n,t,e)=>{if(!t.has(n))throw TypeError("Cannot "+e)};var d=(n,t,e)=>(W(n,t,"read from private field"),e?e.call(n):t.get(n)),F=(n,t,e)=>{if(t.has(n))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(n):t.set(n,e)},B=(n,t,e,i)=>(W(n,t,"write to private field"),i?i.call(n,e):t.set(n,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function e(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=e(s);fetch(s.href,o)}})();class wt{constructor(t){a(this,"animationStartTime",0);a(this,"animationStartOffset",0);a(this,"networkDelay");a(this,"maxOffset");a(this,"offset",0);a(this,"parallax");a(this,"limitFingerDrag");a(this,"boostVelocity");a(this,"targetStopPercent");this.networkDelay=t.networkDelay,this.maxOffset=t.targetOffset,this.parallax=t.parallax,this.limitFingerDrag=t.limitFingerDrag,this.boostVelocity=t.boostVelocity,this.targetStopPercent=t.targetStopPercent}startAnimating(t){this.animationStartTime=t,this.animationStartOffset=this.offset}pointerUp(t){return"success"}committed(){return performance.now()-this.animationStartTime>=this.networkDelay}}function Rt(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var ot={exports:{}};(function(n){(function(){n.exports=t;function t(e,i,s,o){typeof s=="object"&&(o=s,s=!1),typeof o>"u"&&(o={});for(var l=0,c=0,v=0,h=0,m=e.length,u=0;u<m;++u)l+=e[u],c+=i[u],v+=e[u]*i[u],h+=e[u]*e[u];if(o.m=(v-l*c/m)/(h-l*l/m),o.b=c/m-o.m*l/m,s){for(var K=0,P=0;P<m;++P)K+=(i[P]-o.b-o.m*e[P])*(i[P]-o.b-o.m*e[P]);var J=m*h-l*l,Q=1/(m-2)*K;o.bErr=Math.sqrt(Q/J*h),o.mErr=Math.sqrt(m/J*Q)}return function(Dt){return o.m*Dt+o.b}}})()})(ot);var Ot=ot.exports;const Ft=Rt(Ot);function r(){throw new Error("missing element")}function at(n){let t={m:0};const e=n.map(s=>s.offset),i=n.map(s=>s.time);return Ft(i,e,!1,t),t.m,t.m}const Y=10,Bt=10;class C{constructor(t){a(this,"mass",1);a(this,"initialVelocity",0);a(this,"dampingRatio");a(this,"undampedNaturalFrequency");a(this,"dampedNaturalFrequency");a(this,"lastNFrames");a(this,"name");a(this,"overshootCurve",t=>t);const e=(2*Math.PI/t.frequencyResponse)**2*this.mass;this.undampedNaturalFrequency=Math.sqrt(e/this.mass),this.dampedNaturalFrequency=this.undampedNaturalFrequency*Math.sqrt(Math.abs(1-t.dampingRatio**2)),this.dampingRatio=t.dampingRatio,this.lastNFrames=[],this.name=t.name,t.overshootCurve&&(this.overshootCurve=t.overshootCurve)}position(t,e){const i=this.undampedNaturalFrequency*this.dampingRatio,s=this.dampedNaturalFrequency,o=(this.initialVelocity+i*t)/s,l=t;let c=Math.exp(-i*e)*(o*Math.sin(s*e)+l*Math.cos(s*e));if(c<0&&(c=this.overshootCurve(c)),isNaN(c)||!isFinite(c))throw"Spring config invalid. Position: "+c;this.lastNFrames.push({offset:c,time:e});let v=!1;if(this.lastNFrames.length>Y){this.lastNFrames.shift();let h=0;for(let m of this.lastNFrames)h+=m.offset*m.offset;v=h<Bt*Y}return c<1&&(v=!0),{offset:c,done:v}}velocity(){return at(this.lastNFrames)}}var S,y,I;class qt extends wt{constructor(e){super(e);F(this,S,void 0);F(this,y,void 0);F(this,I,void 0);a(this,"lastRaf",null);a(this,"hasCommitted",!1);a(this,"hasAborted",!1);a(this,"pointerHistory",[]);a(this,"spring80FrequencyResponseInput",document.getElementById("spring80FrequencyResponse")??r());a(this,"spring80FrequencyResponseDisplay",document.getElementById("spring80FrequencyResponseDisplay")??r());a(this,"spring80DampingRatioInput",document.getElementById("spring80DampingRatio")??r());a(this,"spring80DampingRatioDisplay",document.getElementById("spring80DampingRatioDisplay")??r());a(this,"spring80FrequencyResponse",parseFloat(this.spring80FrequencyResponseInput.value));a(this,"spring80DampingRatio",parseFloat(this.spring80DampingRatioInput.value));this.animationStartOffset=0,this.spring80FrequencyResponseInput.addEventListener("input",()=>this.updateDisplays()),this.spring80DampingRatioInput.addEventListener("input",()=>this.updateDisplays()),B(this,S,new C({frequencyResponse:200,dampingRatio:.95,name:"100%"})),B(this,y,new C({frequencyResponse:this.spring80FrequencyResponse,dampingRatio:this.spring80DampingRatio,name:"80%"})),B(this,I,new C({frequencyResponse:200,dampingRatio:.9,name:"0%"}))}updateDisplays(){this.spring80FrequencyResponseDisplay.innerHTML=this.spring80FrequencyResponseInput.value,this.spring80DampingRatioDisplay.innerHTML=this.spring80DampingRatioInput.value}advance(e){e=e,!this.hasCommitted&&this.committed()&&(this.startAnimating(this.lastRaf||e),this.hasCommitted=!0,d(this,S).initialVelocity=d(this,y).velocity());const i=e-this.animationStartTime;let s=null;return this.hasAborted?(s=d(this,I).position(this.animationStartOffset,i),this.offset=Math.max(s.offset,0)):this.hasCommitted?(s=d(this,S).position(this.maxOffset-this.animationStartOffset,i),this.offset=this.maxOffset-s.offset):(s=d(this,y).position(this.maxOffset*this.targetStopPercent-this.animationStartOffset,i),this.offset=this.maxOffset*this.targetStopPercent-s.offset),this.lastRaf=e,{done:s.done&&(this.hasCommitted||this.hasAborted),fgOffset:this.offset,bgOffset:this.fgToBgOffset(this.offset),hasCommitted:this.hasCommitted}}pointerMove(e){return this.offset=this.fingerDragAdd(this.offset,e.movementX),this.pointerHistory.push({offset:this.offset,time:e.timeStamp}),this.pointerHistory.length>10&&this.pointerHistory.shift(),this.offset<0&&(this.offset=0),{done:!1,fgOffset:this.offset,bgOffset:this.fgToBgOffset(this.offset),hasCommitted:!1}}fingerDragAdd(e,i){return this.limitFingerDrag?e+this.targetStopPercent*i:e+i}fgToBgOffset(e){return this.parallax?.25*(e-this.maxOffset):0}pointerUp(e){let i=at(this.pointerHistory);return this.boostVelocity&&(i*=4,i=Math.max(i,1)),i=Math.min(i,2),(this.offset+i*100)/this.maxOffset<.3||i<-.1?(this.hasAborted=!0,d(this,I).initialVelocity=-i,"abort"):(d(this,y).initialVelocity=-i,"success")}}S=new WeakMap,y=new WeakMap,I=new WeakMap;let T=!1,L=!1,x=!1,H=!1,A=!1,U=!1,p=["resources/srp-cats.png","resources/srp-couches.png"],f=0;const rt=document.body??r(),lt=document.getElementById("scrim")??r(),Lt=document.getElementById("globalProgress")??r(),ct=document.getElementById("attributedProgress")??r(),O=document.getElementById("networkDelayInput")??r(),xt=document.getElementById("networkDelayDisplay")??r(),mt=document.getElementById("networkDelayLoadInput")??r(),At=document.getElementById("networkDelayLoadDisplay")??r(),Mt=document.getElementById("zoomDisplay")??r(),kt=document.getElementById("buttonTest")??r(),Tt=document.getElementById("buttonSettings")??r(),ft=document.getElementById("settingsPanel")??r(),ut=document.getElementById("screenshots")??r(),Nt=document.getElementById("targetStopDisplay")??r();var nt;const dt=((nt=document.getElementById("frontimg"))==null?void 0:nt.querySelector("img"))??r();var st;const V=((st=document.getElementById("midimg"))==null?void 0:st.querySelector("img"))??r();var it;const _=((it=document.getElementById("backimg"))==null?void 0:it.querySelector("img"))??r(),Ct=document.getElementById("settingParallax")??r(),Ht=document.getElementById("settingLimitFingerDrag")??r(),$=document.getElementById("settingZoom")??r(),pt=document.getElementById("settingProgressAttribution")??r(),Vt=document.getElementById("settingUnloadHandler")??r(),_t=document.getElementById("settingBoostVelocity")??r(),Z=document.getElementById("settingTargetStop")??r();let E=ct,R=E.querySelector(".bar"),$t="lightblue",g=0,j=0,M=0,Ut=["P25","P50","P75","P90","P95","P99"],k=[30,100,330,660,1e3,2360],D=1,N=1;function gt(){let n=k[parseInt(O.value)],t=k[parseInt(mt.value)];return Math.max(n,t)}function Zt(n){var t;((t=n.target)==null?void 0:t.classList[0])!="screenshot"||T||(L=!0,b=G())}function ht(n){return .3+(1-n/document.documentElement.getBoundingClientRect().width)*.5}let q=!1;function zt(n){if(!L)return;let t=b.pointerMove(n);console.log(t),document.documentElement.style.setProperty("--fg-offset",`${t.fgOffset}px`),document.documentElement.style.setProperty("--bg-offset",`${t.bgOffset}px`),document.documentElement.style.setProperty("--scrim",`${ht(t.fgOffset)}`),yt(t.fgOffset),Gt(t.fgOffset)}function yt(n){let t=n/document.documentElement.getBoundingClientRect().width,e=1-(1-N)*t;document.documentElement.style.setProperty("--fg-scale",`${e}`)}function Gt(n){if(n/document.documentElement.getBoundingClientRect().width>.5){if(!q){let e=document.documentElement.animate([{"--bg-scale":N}],{duration:100,fill:"forwards"});e.finished.then(()=>{e.commitStyles(),e.cancel()}),q=!0}}else if(q){let e=document.documentElement.animate([{"--bg-scale":D}],{duration:100,fill:"forwards"});e.finished.then(()=>{e.commitStyles(),e.cancel()}),q=!1}}function Kt(n){if(!L)return;if(L=!1,H=!1,b.pointerUp(n)=="abort")X(),x=!0;else if(Vt.checked){let e=document.documentElement.style.getPropertyValue("--fg-offset"),i=document.documentElement.style.getPropertyValue("--fg-scale"),s=document.documentElement.getBoundingClientRect().width*10/100,o=document.documentElement.animate([{"--fg-scale":1,"--fg-offset":s+"px"}],{duration:300,fill:"forwards"});o.finished.then(()=>{if(o.commitStyles(),o.cancel(),window.confirm("are you sure you want to leave this page?  It's very nice.")){let l=document.documentElement.animate([{"--fg-scale":i,"--fg-offset":e}],{duration:200,fill:"forwards"});l.finished.then(()=>{l.commitStyles(),l.cancel(),X(),et().then(tt)})}});return}et().then(tt)}function Jt(){let n=document.documentElement.animate([{"--fg-scale":N,"--bg-scale":1}],{duration:100,fill:"forwards"});n.finished.then(()=>{n.commitStyles(),n.cancel()})}function X(){let n=document.documentElement.animate([{"--fg-scale":1,"--bg-scale":D}],{duration:100,fill:"forwards"});n.finished.then(()=>{n.commitStyles(),n.cancel()})}function tt(){U=!0,document.documentElement.animate([{"--scrim":0}],{duration:100}).finished.then(vt),A=!x,A?Et():z()}function Et(){let n=performance.now();if(n>=M){z();return}E.style.display="block",R.max=M-g,R.value=n-g,requestAnimationFrame(Et)}let b=G();Pt();function bt(n,t){const e=b.advance(n);document.documentElement.style.setProperty("--fg-offset",`${e.fgOffset}px`),document.documentElement.style.setProperty("--bg-offset",`${e.bgOffset}px`),document.documentElement.style.setProperty("--scrim",`${ht(e.fgOffset)}`),yt(e.fgOffset),n-g>800&&(E.style.display="block"),e.hasCommitted&&!H&&(Jt(),H=!0),e.done?t():requestAnimationFrame(i=>{bt(i,t)})}function et(){return T=!0,g=performance.now(),j=g+parseFloat(O.value),M=g+gt(),console.log("start : "+g+" commit : "+j+" load : "+M),b.startAnimating(g),new Promise(n=>{bt(performance.now(),n)})}function vt(){U=!1,document.documentElement.style.setProperty("--fg-offset","0px"),document.documentElement.style.setProperty("--vertical-offset","0px"),document.documentElement.style.setProperty("--scrim","0.0"),document.documentElement.style.setProperty("--bg-scale",D.toString()),document.documentElement.style.setProperty("--fg-scale","1.0"),x?(document.documentElement.style.setProperty("--main-background-color",$t),x=!1):Qt(),A||(T=!1)}function z(){A=!1,E.style.display="none",R.removeAttribute("value"),R.removeAttribute("max"),U||(T=!1)}function Pt(){vt(),z()}function G(){return new qt({networkDelay:k[parseInt(O.value)],targetOffset:document.documentElement.getBoundingClientRect().width,parallax:!!Ct.checked,limitFingerDrag:!!Ht.checked,boostVelocity:!!_t.checked,targetStopPercent:parseFloat(Z.value)})}function w(){let n=parseInt(O.value);xt.innerHTML=Ut[n]+"="+k[n].toString(),At.innerHTML=gt().toString(),D=parseInt($.value)/100,N=D+(1-D)/3,Mt.innerHTML=$.value.toString(),Nt.innerHTML=`${100*parseFloat(Z.value)}`,b.updateDisplays(),b=G(),Pt()}function Qt(){dt.src=V.src,V.src=_.src,_.src=p[f],f=(f+1)%p.length}function Wt(){ft.style.display="none",lt.style.display="block",ut.style.display="block",rt.classList.add("test")}function Yt(){ft.style.display="flex",lt.style.display="none",ut.style.display="none",rt.classList.remove("test")}function jt(){pt.checked?E=ct:E=Lt,R=E.querySelector(".bar")}function Xt(){O.addEventListener("input",w),mt.addEventListener("input",w),$.addEventListener("input",w),Z.addEventListener("input",w),kt.addEventListener("click",Wt),Tt.addEventListener("click",Yt),dt.src=p[f],f=(f+1)%p.length,V.src=p[f],f=(f+1)%p.length,_.src=p[f],f=(f+1)%p.length,pt.addEventListener("change",jt),w(),window.addEventListener("pointerdown",Zt),window.addEventListener("pointerup",Kt),window.addEventListener("pointermove",zt)}onload=Xt;
