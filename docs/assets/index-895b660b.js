var qt=Object.defineProperty;var Mt=(t,n,e)=>n in t?qt(t,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[n]=e;var a=(t,n,e)=>(Mt(t,typeof n!="symbol"?n+"":n,e),e),rt=(t,n,e)=>{if(!n.has(t))throw TypeError("Cannot "+e)};var f=(t,n,e)=>(rt(t,n,"read from private field"),e?e.call(t):n.get(t)),q=(t,n,e)=>{if(n.has(t))throw TypeError("Cannot add the same private member more than once");n instanceof WeakSet?n.add(t):n.set(t,e)},M=(t,n,e,i)=>(rt(t,n,"write to private field"),i?i.call(t,e):n.set(t,e),e);(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function e(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=e(s);fetch(s.href,o)}})();class Lt{constructor(n){a(this,"animationStartTime",0);a(this,"animationStartOffset",0);a(this,"networkDelay");a(this,"maxOffset");a(this,"offset",0);a(this,"parallax");a(this,"fingerDragCurve");a(this,"boostVelocity");a(this,"targetStopPercent");a(this,"loadStart",0);this.networkDelay=n.networkDelay,this.maxOffset=n.targetOffset,this.parallax=n.parallax,this.fingerDragCurve=n.fingerDragCurve,this.boostVelocity=n.boostVelocity,this.targetStopPercent=n.targetStopPercent}startAnimating(n){this.loadStart=n,this.animationStartTime=n,this.animationStartOffset=this.offset}restartAnimating(n){this.animationStartTime=n,this.animationStartOffset=this.offset}pointerUp(n){return"success"}committed(n){return n-this.loadStart>=this.networkDelay}}function Ct(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var gt={exports:{}};(function(t){(function(){t.exports=n;function n(e,i,s,o){typeof s=="object"&&(o=s,s=!1),typeof o>"u"&&(o={});for(var l=0,c=0,v=0,d=0,m=e.length,u=0;u<m;++u)l+=e[u],c+=i[u],v+=e[u]*i[u],d+=e[u]*e[u];if(o.m=(v-l*c/m)/(d-l*l/m),o.b=c/m-o.m*l/m,s){for(var P=0,b=0;b<m;++b)P+=(i[b]-o.b-o.m*e[b])*(i[b]-o.b-o.m*e[b]);var F=m*d-l*l,at=1/(m-2)*P;o.bErr=Math.sqrt(at/F*d),o.mErr=Math.sqrt(m/F*at)}return function(Ft){return o.m*Ft+o.b}}})()})(gt);var Tt=gt.exports;const Vt=Ct(Tt);function r(){throw new Error("missing element")}function yt(t){let n={m:0};const e=t.map(s=>s.offset),i=t.map(s=>s.time);return Vt(i,e,!1,n),n.m,n.m}const lt=10,Nt=10;class J{constructor(n){a(this,"mass",1);a(this,"initialVelocity",0);a(this,"dampingRatio");a(this,"undampedNaturalFrequency");a(this,"dampedNaturalFrequency");a(this,"lastNFrames");a(this,"name");a(this,"overshootCurve",n=>n);const e=(2*Math.PI/n.frequencyResponse)**2*this.mass;this.undampedNaturalFrequency=Math.sqrt(e/this.mass),this.dampedNaturalFrequency=this.undampedNaturalFrequency*Math.sqrt(Math.abs(1-n.dampingRatio**2)),this.dampingRatio=n.dampingRatio,this.lastNFrames=[],this.name=n.name,n.overshootCurve&&(this.overshootCurve=n.overshootCurve)}position(n,e){const i=this.undampedNaturalFrequency*this.dampingRatio,s=this.dampedNaturalFrequency,o=(this.initialVelocity+i*n)/s,l=n;let c=Math.exp(-i*e)*(o*Math.sin(s*e)+l*Math.cos(s*e));if(c<0&&(c=this.overshootCurve(c)),isNaN(c)||!isFinite(c))throw"Spring config invalid. Position: "+c;this.lastNFrames.push({offset:c,time:e});let v=!1;if(this.lastNFrames.length>lt){this.lastNFrames.shift();let d=0;for(let m of this.lastNFrames)d+=m.offset*m.offset;v=d<Nt*lt}return c<1&&(v=!0),{offset:c,done:v}}velocity(){return yt(this.lastNFrames)}}var I,y,D;class Ht extends Lt{constructor(e){super(e);q(this,I,void 0);q(this,y,void 0);q(this,D,void 0);a(this,"lastRaf",null);a(this,"hasCommitted",!1);a(this,"hasAborted",!1);a(this,"pointerHistory",[]);a(this,"spring80FrequencyResponseInput",document.getElementById("spring80FrequencyResponse")??r());a(this,"spring80FrequencyResponseDisplay",document.getElementById("spring80FrequencyResponseDisplay")??r());a(this,"spring80DampingRatioInput",document.getElementById("spring80DampingRatio")??r());a(this,"spring80DampingRatioDisplay",document.getElementById("spring80DampingRatioDisplay")??r());a(this,"hookAtInput",document.getElementById("hookAt")??r());a(this,"hookAtDisplay",document.getElementById("hookAtDisplay")??r());a(this,"spring80FrequencyResponse",parseFloat(this.spring80FrequencyResponseInput.value));a(this,"spring80DampingRatio",parseFloat(this.spring80DampingRatioInput.value));a(this,"hookAtPercent",parseFloat(this.hookAtInput.value));a(this,"hooked",!1);a(this,"pointerDownX",0);a(this,"dontBounceBackpageInput",document.getElementById("settingDontBounceBackpage")??r());a(this,"dontBounceBackpage",!!this.dontBounceBackpageInput.checked);a(this,"wobbleInput",document.getElementById("settingWobble")??r());a(this,"wobble",!!this.wobbleInput.checked);a(this,"slowDriftInput",document.getElementById("settingSlowDrift")??r());a(this,"slowDrift",!!this.slowDriftInput.checked);this.animationStartOffset=0,this.spring80FrequencyResponseInput.addEventListener("input",()=>this.updateDisplays()),this.spring80DampingRatioInput.addEventListener("input",()=>this.updateDisplays()),this.hookAtInput.addEventListener("input",()=>this.updateDisplays()),this.dontBounceBackpageInput.addEventListener("input",()=>this.updateDisplays()),this.wobbleInput.addEventListener("input",()=>this.updateDisplays()),this.slowDriftInput.addEventListener("input",()=>this.updateDisplays()),M(this,I,new J({frequencyResponse:200,dampingRatio:.95,name:"100%"})),M(this,y,new J({frequencyResponse:this.spring80FrequencyResponse,dampingRatio:this.spring80DampingRatio,name:"80%"})),M(this,D,new J({frequencyResponse:200,dampingRatio:.9,name:"0%"}))}updateDisplays(){this.spring80FrequencyResponseDisplay.innerHTML=this.spring80FrequencyResponseInput.value,this.spring80DampingRatioDisplay.innerHTML=this.spring80DampingRatioInput.value,this.hookAtDisplay.innerHTML=this.hookAtInput.value,this.dontBounceBackpage=!!this.dontBounceBackpageInput.checked,this.wobble=!!this.wobbleInput.checked,this.slowDrift=!!this.slowDriftInput.checked}advance(e){e=e,!this.hasCommitted&&this.committed(e)&&(this.restartAnimating(this.lastRaf||e),this.hasCommitted=!0,this.hooked?f(this,I).initialVelocity=f(this,y).velocity():(this.hooked=!0,f(this,I).initialVelocity=f(this,y).initialVelocity),isNaN(f(this,I).initialVelocity)&&(f(this,I).initialVelocity=-2));const i=e-this.animationStartTime;let s=null;this.hooked?this.hasAborted?(s=f(this,D).position(this.animationStartOffset,i),this.offset=Math.max(s.offset,0)):this.hasCommitted?(s=f(this,I).position(this.maxOffset-this.animationStartOffset,i),this.offset=this.maxOffset-s.offset):(s=f(this,y).position(this.maxOffset*this.targetStopPercent-this.animationStartOffset,i),this.offset=this.maxOffset*this.targetStopPercent-s.offset):this.offset=this.animationStartOffset-i*f(this,y).initialVelocity,!this.hooked&&this.offset>this.maxOffset*this.hookAtPercent/100&&(this.restartAnimating(this.lastRaf||e),this.hooked=!0,this.animationStartOffset=this.offset);let o=s?s.done:!1;this.wobble&&!this.hasCommitted&&(this.offset+=this.maxOffset*.02*Math.sin(2*Math.PI*i/1e3)),this.slowDrift&&!this.hasCommitted&&(this.offset-=this.maxOffset*.25*1e3/(i+1e3),console.log(1e3/(i+1e3)));let l=this.offset;return this.dontBounceBackpage&&(s=f(this,D).position(this.maxOffset-this.animationStartOffset,e-this.loadStart),l=this.maxOffset-Math.max(s.offset,0)),this.lastRaf=e,{done:o&&(this.hasCommitted||this.hasAborted),fgOffset:this.offset,bgOffset:this.fgToBgOffset(l),hasCommitted:this.hasCommitted}}pointerDown(e){this.pointerDownX=e.clientX}pointerMove(e){return this.offset=this.fingerDragCurve(e.clientX-this.pointerDownX),this.pointerHistory.push({offset:this.offset,time:e.timeStamp}),this.pointerHistory.length>10&&this.pointerHistory.shift(),this.offset<0&&(this.offset=0),{done:!1,fgOffset:this.offset,bgOffset:this.fgToBgOffset(this.offset),hasCommitted:!1}}fgToBgOffset(e){return this.parallax?.25*(e-this.maxOffset):0}setDefaultVelocity(){this.offset=this.maxOffset/4,f(this,y).initialVelocity=this.boostVelocity?-2.5:-1}pointerUp(e){let i=yt(this.pointerHistory);return this.boostVelocity&&(i*=3,i=Math.max(i,1)),i=Math.min(i,2.5),i=Math.max(i,.3),f(this,D).initialVelocity=-i,(this.offset+i*100)/this.maxOffset<.3||i<-.1?(this.hasAborted=!0,f(this,D).initialVelocity=-i,"abort"):(f(this,y).initialVelocity=-i,"success")}}I=new WeakMap,y=new WeakMap,D=new WeakMap;let U=!1,H=!1,A=!1,Y=!1,R=!1,st=!1,w=[{main:"resources/srp-couches.png"},{main:"resources/pants-hemming-srp.png",precommit:"resources/pants-srp.png"},{main:"resources/srp-cats.png"},{main:"resources/banana-pie-srp.png"},{main:"resources/goo.gl-stock-a.png",precommit:"resources/goo.gl-stock-b.png"},{main:"resources/news-frontpage.png"},{main:"resources/news-article.png"}],p=0;const vt=document.body??r(),bt=document.getElementById("scrim")??r(),Z=document.getElementById("globalProgress")??r(),Et=document.getElementById("attributedProgress")??r(),x=document.getElementById("networkDelayInput")??r(),_t=document.getElementById("networkDelayDisplay")??r(),$t=document.getElementById("zoomDisplay")??r(),Ut=document.getElementById("buttonTest")??r(),Zt=document.getElementById("buttonSettings")??r(),It=document.getElementById("settingsPanel")??r(),wt=document.getElementById("screenshots")??r(),zt=document.getElementById("targetStopDisplay")??r(),T=document.getElementById("dragCurve")??r(),Q=document.getElementById("chevron")??r(),g=document.getElementById("chevronContainer")??r(),Xt=document.getElementById("settingChevron")??r();var dt;const _=((dt=document.getElementById("frontimg"))==null?void 0:dt.querySelector("img"))??r();var pt;const j=((pt=document.getElementById("midimg"))==null?void 0:pt.querySelector("img"))??r();var ht;const z=((ht=document.getElementById("midimgprecommit"))==null?void 0:ht.querySelector("img"))??r(),tt=document.getElementById("settingZoom")??r(),Dt=document.getElementById("settingProgressAttribution")??r(),Gt=document.getElementById("settingUnloadHandler")??r(),St=document.getElementById("settingBoostVelocity")??r(),X=document.getElementById("settingTargetStop")??r(),Wt=document.getElementById("settingFadeForeground")??r();let k=Et,et=k.querySelector(".bar"),$=Z.querySelector(".bar"),B=0,nt=0,Kt=["P25","P50","P75","P90","P95","P99"],G=[30,100,330,660,1e3,2360],O=1,W=1;function Jt(){let t=G[parseInt(x.value)];return Math.min(Math.max(t+500,t*2),t+1e3)}function Qt(t){var n;((n=t.target)==null?void 0:n.classList[0])!="screenshot"||U&&!R||(A=!0,ot(),H=!0,S=K(),S.pointerDown(t))}function Bt(t){return .3+(1-t)*.5}let L=!1,h=null,V=0,ct=50;function N(t){if(!H)return;h||(h=t);let n=t.x-h.x;h=t,V=Math.min(Math.max(V+n,0),ct),Pt(V/ct);let e=S.pointerMove(t),i=e.fgOffset/document.documentElement.getBoundingClientRect().width;document.documentElement.style.setProperty("--fg-offset",`${e.fgOffset}px`),document.documentElement.style.setProperty("--bg-offset",`${e.bgOffset}px`),document.documentElement.style.setProperty("--scrim",`${Bt(i)}`),xt(i),kt(e.fgOffset),Yt(e.fgOffset)}let C=!1;function Pt(t){Xt.checked||(t=0),g.style.display="block",t>.7?(g.style.left="25px",g.style.borderRadius="50%",g.style.width=getComputedStyle(g).height,Q.style.opacity="1",C||(navigator.vibrate(1),C=!0)):t>.1?(C=!1,g.style.left="1px",g.style.borderRadius="15px",g.style.width=`${g.getBoundingClientRect().height*(t-.1)/.6}px`,Q.style.opacity=`${Math.min(Math.max((t-.5)/.2,0),1)}`):(C=!1,g.style.display="none",Q.style.opacity="0")}function kt(t){let n=t/document.documentElement.getBoundingClientRect().width,e=1-(1-W)*n;document.documentElement.style.setProperty("--fg-scale",`${e}`)}function Yt(t){if(t/document.documentElement.getBoundingClientRect().width>.5){if(!L){let e=document.documentElement.animate([{"--bg-scale":W}],{duration:100,fill:"forwards"});e.finished.then(()=>{e.commitStyles(),e.cancel()}),L=!0}}else if(L){let e=document.documentElement.animate([{"--bg-scale":O}],{duration:100,fill:"forwards"});e.finished.then(()=>{e.commitStyles(),e.cancel()}),L=!1}}function jt(t){if(h=null,Pt(0),V=0,!H)return;if(H=!1,Y=!1,S.pointerUp(t)=="abort")mt(),A=!0;else if(Gt.checked){let e=document.documentElement.style.getPropertyValue("--fg-offset"),i=document.documentElement.style.getPropertyValue("--fg-scale"),s=document.documentElement.animate([{"--fg-scale":1,"--fg-offset":"0px"}],{duration:300,fill:"forwards"});s.finished.then(()=>{if(s.commitStyles(),s.cancel(),window.confirm("are you sure you want to leave this page?  It's very nice.")){let o=document.documentElement.animate([{"--fg-scale":i,"--fg-offset":e}],{duration:200,fill:"forwards"});o.finished.then(()=>{o.commitStyles(),o.cancel(),mt(),ut().then(ft)})}});return}ut().then(ft)}function te(){let t=document.documentElement.animate([{"--fg-scale":W,"--bg-scale":1}],{duration:100,fill:"forwards"});t.finished.then(()=>{t.commitStyles(),t.cancel()});const n=z.animate({opacity:0},{duration:100,fill:"forwards"});n.finished.then(()=>{n.commitStyles(),n.cancel()})}function mt(){let t=document.documentElement.animate([{"--fg-scale":1,"--bg-scale":O}],{duration:100,fill:"forwards"});t.finished.then(()=>{t.commitStyles(),t.cancel()})}function ft(){st=!0,document.documentElement.animate([{"--scrim":0}],{duration:100}).finished.then(At),R=!A,R?Ot():it()}function Ot(){if(!R)return;let t=performance.now();if(t>=nt){it();return}Z.style.display="block",$.max=nt-B,$.value=t-B,requestAnimationFrame(Ot)}let S=K();ot();function Rt(t,n){const e=S.advance(t);document.documentElement.style.setProperty("--fg-offset",`${e.fgOffset}px`),document.documentElement.style.setProperty("--bg-offset",`${e.bgOffset}px`);let i=e.fgOffset/document.documentElement.getBoundingClientRect().width;const s=Bt(i);xt(i);const o=s+.1*Math.sin((t-B)/200);document.documentElement.style.setProperty("--scrim",`${o}`),kt(e.fgOffset),t-B>800&&(k.style.display="block"),e.hasCommitted&&!Y&&(te(),Y=!0),e.done?n():requestAnimationFrame(l=>{Rt(l,n)})}function ut(){return U=!0,B=performance.now(),nt=B+Jt(),S.startAnimating(B),new Promise(t=>{Rt(performance.now(),t)})}function At(){st=!1,document.documentElement.style.setProperty("--fg-offset","0px"),document.documentElement.style.setProperty("--vertical-offset","0px"),document.documentElement.style.setProperty("--scrim","0.0"),document.documentElement.style.setProperty("--bg-scale",O.toString()),document.documentElement.style.setProperty("--fg-scale","1.0"),z.style.opacity="1",A||ne(),A=!1,R||(U=!1)}function it(){R=!1,k.style.display="none",et.removeAttribute("value"),et.removeAttribute("max"),Z.style.display="none",$.removeAttribute("value"),$.removeAttribute("max"),st||(U=!1)}function ot(){it(),At()}function K(){const t=document.documentElement.getBoundingClientRect().width,n=parseFloat(X.value);let e=i=>i;if(T.value=="linear80")e=i=>i*n;else if(T.value=="linearelastic")e=i=>{const s=i/t,o=.7;return s<o?i:(o+(s-o)/20)*t};else if(T.value=="snapto"){let i=0,s=0,o=-999,l=!1,c=-1,v=4,d=1,m=[];e=u=>{o==-999&&(o=u);let P=u-o;if(o=u,l&&(i<c*t?(i+=v,i>=c*t&&(i=c*t,l=!1,s=0)):i>c*t&&(i-=v,i<=c*t&&(i=c*t,l=!1,s=0))),l)return requestAnimationFrame(()=>{h!==null&&N(h)}),i;m.push(P),m.length>5&&m.shift();let b=0;for(let F of m)F*d<0&&b++;return b==m.length&&(d=-d,s=0),s+=P,c<n&&s/t>.1?(c=n,l=!0,requestAnimationFrame(()=>{h!==null&&N(h)})):c>0&&s/t<-.05?(c=0,l=!0,requestAnimationFrame(()=>{h!==null&&N(h)})):i+=.1*P,i}}return new Ht({networkDelay:G[parseInt(x.value)],targetOffset:t,parallax:!0,fingerDragCurve:e,boostVelocity:!!St.checked,targetStopPercent:n})}function ee(){let t=document.documentElement.getBoundingClientRect().width,n=K();n.setDefaultVelocity(),n.startAnimating(0);var e=document.getElementById("plot")??r();let i=e.width/1e3;e.height=t*i;var s=e.getContext("2d");if(!s)return;s.scale(i,i),s.lineWidth=3,s.strokeStyle="black",s.beginPath(),s.moveTo(0,0);for(var o=0;o<1e3;o++)s.lineTo(o,n.advance(o).fgOffset);s.stroke(),s.strokeStyle="red";let l=t*parseFloat(X.value);s.beginPath(),s.moveTo(0,l),s.lineTo(1e3,l),s.stroke(),s.strokeStyle="green";let c=G[parseInt(x.value)];s.beginPath(),s.moveTo(c,0),s.lineTo(c,t),s.stroke()}function E(){let t=parseInt(x.value);_t.innerHTML=Kt[t]+"="+G[t].toString(),O=parseInt(tt.value)/100,W=O+(1-O)/3,$t.innerHTML=tt.value.toString(),zt.innerHTML=`${100*parseFloat(X.value)}`,S.updateDisplays(),ee(),S=K(),ot()}function xt(t){Wt.checked&&(_.style.filter=`grayscale(${t})`)}function ne(){_.style.filter="",_.src=j.src,j.src=w[p].main,z.src=w[p].precommit??"",p=(p+1)%w.length}function se(){It.style.display="none",bt.style.display="block",wt.style.display="block",document.documentElement.style.setProperty("--main-background-color","#202020"),vt.classList.add("test")}function ie(){It.style.display="flex",bt.style.display="none",wt.style.display="none",document.documentElement.style.setProperty("--main-background-color","white"),vt.classList.remove("test")}function oe(){Dt.checked?k=Et:k=Z,et=k.querySelector(".bar")}function ae(){x.addEventListener("input",E),tt.addEventListener("input",E),X.addEventListener("input",E),St.addEventListener("input",E),T.addEventListener("input",E);let t=document.getElementById("spring80FrequencyResponse")??r(),n=document.getElementById("spring80DampingRatio")??r(),e=document.getElementById("hookAt")??r();t.addEventListener("input",E),n.addEventListener("input",E),e.addEventListener("input",E),Ut.addEventListener("click",se),Zt.addEventListener("click",ie),_.src=w[p].main,p=(p+1)%w.length,j.src=w[p].main,z.src=w[p].precommit??"",p=(p+1)%w.length,Dt.addEventListener("change",oe),E(),window.addEventListener("pointerdown",Qt),window.addEventListener("pointerup",jt),window.addEventListener("pointermove",N)}onload=ae;
