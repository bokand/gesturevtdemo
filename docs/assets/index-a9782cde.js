var x=Object.defineProperty;var k=(e,t,n)=>t in e?x(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var i=(e,t,n)=>(k(e,typeof t!="symbol"?t+"":t,n),n),T=(e,t,n)=>{if(!t.has(e))throw TypeError("Cannot "+n)};var g=(e,t,n)=>(T(e,t,"read from private field"),n?n.call(e):t.get(e)),d=(e,t,n)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,n)},u=(e,t,n,o)=>(T(e,t,"write to private field"),o?o.call(e,n):t.set(e,n),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function n(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(s){if(s.ep)return;s.ep=!0;const r=n(s);fetch(s.href,r)}})();class _{constructor(t){i(this,"dragStartTime");i(this,"animationStartTime",0);i(this,"animationStartOffset",0);i(this,"networkDelay");i(this,"maxOffset");i(this,"offset",0);this.dragStartTime=t.dragStartTime,this.networkDelay=t.networkDelay,this.maxOffset=t.targetOffset}startAnimating(t){this.animationStartTime=t,this.animationStartOffset=this.offset}committed(){return performance.now()-this.dragStartTime>=this.networkDelay}}const F=10,b=10;class w{constructor(t){i(this,"mass",1);i(this,"initialVelocity",0);i(this,"dampingRatio");i(this,"undampedNaturalFrequency");i(this,"dampedNaturalFrequency");i(this,"lastNFrames");const n=(2*Math.PI/t.frequencyResponse)**2*this.mass;this.undampedNaturalFrequency=Math.sqrt(n/this.mass),this.dampedNaturalFrequency=this.undampedNaturalFrequency*Math.sqrt(Math.abs(1-t.dampingRatio**2)),this.dampingRatio=t.dampingRatio,this.lastNFrames=[]}position(t,n){const o=this.undampedNaturalFrequency*this.dampingRatio,s=this.dampedNaturalFrequency,r=(this.initialVelocity+o*t)/s,c=t,l=Math.exp(-o*n)*(r*Math.sin(s*n)+c*Math.cos(s*n));if(isNaN(l)||!isFinite(l))throw"Spring config invalid. Position: "+l;console.log(this),this.lastNFrames.push(l);let N=!1;if(this.lastNFrames.length>F){this.lastNFrames.shift();let D=0;for(let M of this.lastNFrames)D+=M*M;N=D<b*F}return{offset:l,done:N}}}var m,f,y;class B extends _{constructor(n){super(n);d(this,m,void 0);d(this,f,void 0);d(this,y,void 0);i(this,"hasCommitted",!1);u(this,m,new w({frequencyResponse:1.2,dampingRatio:.9})),u(this,f,new w({frequencyResponse:1.2,dampingRatio:.8})),u(this,y,new w({frequencyResponse:1.2,dampingRatio:.9})),console.log("NEW MODEL "+this.networkDelay)}updateDisplays(){}advance(n){const o=(n-this.animationStartTime)/1e3;!this.hasCommitted&&this.committed()&&(console.log("COMMIT"),console.log(this),this.startAnimating(n),this.hasCommitted=!0);let s=null;return this.hasCommitted?(s=g(this,m).position(this.maxOffset-this.animationStartOffset,o),this.offset=this.maxOffset-s.offset):(console.log("NOT THERE YET."),s=g(this,f).position(this.maxOffset*.8-this.animationStartOffset,o),this.offset=this.maxOffset*.8-s.offset),console.log("Offset "+this.offset),{done:s.done&&this.hasCommitted,offset:this.offset}}pointerMove(n){return this.offset+=n,this.offset<0&&(this.offset=0),this.offset}}m=new WeakMap,f=new WeakMap,y=new WeakMap;function O(){throw new Error("missing element")}let C=B,p,q,R=!1,h=!1;const I=document.getElementById("scrim")??O(),S=document.getElementById("networkDelayInput")??O(),L=Array.from(document.querySelectorAll('input[name="mode"]')).map(e=>e),H=document.getElementById("networkDelayDisplay")??O();function V(e){var t;((t=e.target)==null?void 0:t.id)!=""||R||(h=!0,a=v(),q=document.startViewTransition(),q.ready.then(()=>{p=document.documentElement.animate({},{duration:100,pseudoElement:"::view-transition-new(root)"}),p.pause(),I.style.display="block"}))}function $(e){if(!h)return;let t=a.pointerMove(e.movementX);document.documentElement.style.setProperty("--offset",`${t}px`);let o=.3+(1-t/document.documentElement.getBoundingClientRect().width)*.5;document.documentElement.style.setProperty("--scrim",`${o}`)}function G(e){h&&(h=!1,Y().then(()=>{document.documentElement.animate([{"--scrim":0}],{duration:100}).finished.then(P)}))}let a=v();P();function A(e,t){const n=a.advance(e);console.log(n),document.documentElement.style.setProperty("--offset",`${n.offset}px`),n.done?t():requestAnimationFrame(o=>{A(o,t)})}function Y(){return R=!0,a.startAnimating(performance.now()),new Promise(e=>{A(performance.now(),e)})}function P(){R=!1,document.documentElement.style.setProperty("--offset","0px"),document.documentElement.style.setProperty("--vertical-offset","0px"),document.documentElement.style.setProperty("--scrim","0.0"),p&&p.play(),I.style.display="none"}function v(){for(const e of L)e.checked&&parseInt(e.value);return new C({dragStartTime:performance.now(),networkDelay:parseFloat(S.value),targetOffset:document.documentElement.getBoundingClientRect().width})}function E(){H.innerHTML=S.value,a.updateDisplays(),a=v(),P()}function K(){S.addEventListener("input",E);for(const e of L)e.addEventListener("click",E);E(),window.addEventListener("pointerdown",V),window.addEventListener("pointerup",G),window.addEventListener("pointermove",$)}onload=K;
