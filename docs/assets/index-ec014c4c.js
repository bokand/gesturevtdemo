var Pt=Object.defineProperty;var St=(n,t,e)=>t in n?Pt(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var r=(n,t,e)=>(St(n,typeof t!="symbol"?t+"":t,e),e),W=(n,t,e)=>{if(!t.has(n))throw TypeError("Cannot "+e)};var p=(n,t,e)=>(W(n,t,"read from private field"),e?e.call(n):t.get(n)),O=(n,t,e)=>{if(t.has(n))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(n):t.set(n,e)},F=(n,t,e,o)=>(W(n,t,"write to private field"),o?o.call(n,e):t.set(n,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function e(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(s){if(s.ep)return;s.ep=!0;const i=e(s);fetch(s.href,i)}})();class Dt{constructor(t){r(this,"animationStartTime",0);r(this,"animationStartOffset",0);r(this,"networkDelay");r(this,"maxOffset");r(this,"offset",0);r(this,"parallax");r(this,"limitFingerDrag");r(this,"boostVelocity");r(this,"targetStopPercent");this.networkDelay=t.networkDelay,this.maxOffset=t.targetOffset,this.parallax=t.parallax,this.limitFingerDrag=t.limitFingerDrag,this.boostVelocity=t.boostVelocity,this.targetStopPercent=t.targetStopPercent}startAnimating(t){this.animationStartTime=t,this.animationStartOffset=this.offset}pointerUp(t){return"success"}committed(){return performance.now()-this.animationStartTime>=this.networkDelay}}function wt(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var it={exports:{}};(function(n){(function(){n.exports=t;function t(e,o,s,i){typeof s=="object"&&(i=s,s=!1),typeof i>"u"&&(i={});for(var l=0,c=0,v=0,h=0,m=e.length,d=0;d<m;++d)l+=e[d],c+=o[d],v+=e[d]*o[d],h+=e[d]*e[d];if(i.m=(v-l*c/m)/(h-l*l/m),i.b=c/m-i.m*l/m,s){for(var K=0,P=0;P<m;++P)K+=(o[P]-i.b-i.m*e[P])*(o[P]-i.b-i.m*e[P]);var J=m*h-l*l,Q=1/(m-2)*K;i.bErr=Math.sqrt(Q/J*h),i.mErr=Math.sqrt(m/J*Q)}return function(vt){return i.m*vt+i.b}}})()})(it);var It=it.exports;const Rt=wt(It);function a(){throw new Error("missing element")}function rt(n){let t={m:0};const e=n.map(s=>s.offset),o=n.map(s=>s.time);return Rt(o,e,!1,t),t.m,t.m}const Y=10,Ot=10;class k{constructor(t){r(this,"mass",1);r(this,"initialVelocity",0);r(this,"dampingRatio");r(this,"undampedNaturalFrequency");r(this,"dampedNaturalFrequency");r(this,"lastNFrames");r(this,"name");r(this,"overshootCurve",t=>t);const e=(2*Math.PI/t.frequencyResponse)**2*this.mass;this.undampedNaturalFrequency=Math.sqrt(e/this.mass),this.dampedNaturalFrequency=this.undampedNaturalFrequency*Math.sqrt(Math.abs(1-t.dampingRatio**2)),this.dampingRatio=t.dampingRatio,this.lastNFrames=[],this.name=t.name,t.overshootCurve&&(this.overshootCurve=t.overshootCurve)}position(t,e){const o=this.undampedNaturalFrequency*this.dampingRatio,s=this.dampedNaturalFrequency,i=(this.initialVelocity+o*t)/s,l=t;let c=Math.exp(-o*e)*(i*Math.sin(s*e)+l*Math.cos(s*e));if(c<0&&(c=this.overshootCurve(c)),isNaN(c)||!isFinite(c))throw"Spring config invalid. Position: "+c;this.lastNFrames.push({offset:c,time:e});let v=!1;if(this.lastNFrames.length>Y){this.lastNFrames.shift();let h=0;for(let m of this.lastNFrames)h+=m.offset*m.offset;v=h<Ot*Y}return c<1&&(v=!0),{offset:c,done:v}}velocity(){return rt(this.lastNFrames)}}var D,y,w;class Ft extends Dt{constructor(e){super(e);O(this,D,void 0);O(this,y,void 0);O(this,w,void 0);r(this,"lastRaf",null);r(this,"hasCommitted",!1);r(this,"hasAborted",!1);r(this,"pointerHistory",[]);r(this,"spring80FrequencyResponseInput",document.getElementById("spring80FrequencyResponse")??a());r(this,"spring80FrequencyResponseDisplay",document.getElementById("spring80FrequencyResponseDisplay")??a());r(this,"spring80DampingRatioInput",document.getElementById("spring80DampingRatio")??a());r(this,"spring80DampingRatioDisplay",document.getElementById("spring80DampingRatioDisplay")??a());r(this,"spring80FrequencyResponse",parseFloat(this.spring80FrequencyResponseInput.value));r(this,"spring80DampingRatio",parseFloat(this.spring80DampingRatioInput.value));this.animationStartOffset=0,this.spring80FrequencyResponseInput.addEventListener("input",()=>this.updateDisplays()),this.spring80DampingRatioInput.addEventListener("input",()=>this.updateDisplays()),F(this,D,new k({frequencyResponse:200,dampingRatio:.95,name:"100%"})),F(this,y,new k({frequencyResponse:this.spring80FrequencyResponse,dampingRatio:this.spring80DampingRatio,name:"80%"})),F(this,w,new k({frequencyResponse:200,dampingRatio:.9,name:"0%"}))}updateDisplays(){this.spring80FrequencyResponseDisplay.innerHTML=this.spring80FrequencyResponseInput.value,this.spring80DampingRatioDisplay.innerHTML=this.spring80DampingRatioInput.value}advance(e){e=e,!this.hasCommitted&&this.committed()&&(this.startAnimating(this.lastRaf||e),this.hasCommitted=!0,p(this,D).initialVelocity=p(this,y).velocity());const o=e-this.animationStartTime;let s=null;return this.hasAborted?(s=p(this,w).position(this.animationStartOffset,o),this.offset=Math.max(s.offset,0)):this.hasCommitted?(s=p(this,D).position(this.maxOffset-this.animationStartOffset,o),this.offset=this.maxOffset-s.offset):(s=p(this,y).position(this.maxOffset*this.targetStopPercent-this.animationStartOffset,o),this.offset=this.maxOffset*this.targetStopPercent-s.offset),this.lastRaf=e,{done:s.done&&(this.hasCommitted||this.hasAborted),fgOffset:this.offset,bgOffset:this.fgToBgOffset(this.offset),hasCommitted:this.hasCommitted}}pointerMove(e){return this.offset=this.fingerDragAdd(this.offset,e.movementX),this.pointerHistory.push({offset:this.offset,time:e.timeStamp}),this.pointerHistory.length>10&&this.pointerHistory.shift(),this.offset<0&&(this.offset=0),{done:!1,fgOffset:this.offset,bgOffset:this.fgToBgOffset(this.offset),hasCommitted:!1}}fingerDragAdd(e,o){return this.limitFingerDrag?e+this.targetStopPercent*o:e+o}fgToBgOffset(e){return this.parallax?.25*(e-this.maxOffset):0}pointerUp(e){let o=rt(this.pointerHistory);return console.log("before: "+o),this.boostVelocity&&(o*=4,o=Math.max(o,1)),console.log("post boost: "+o),o=Math.min(o,2),console.log("post clamp: "+o),(this.offset+o*100)/this.maxOffset<.3||o<-.1?(this.hasAborted=!0,p(this,w).initialVelocity=-o,"abort"):(p(this,y).initialVelocity=-o,"success")}}D=new WeakMap,y=new WeakMap,w=new WeakMap;let N=!1,x=!1,A=!1,C=!1,L=!1,$=!1,g=["resources/srp-cats.png","resources/srp-couches.png","resources/banana-pie-srp.png","resources/goo.gl-stock-a.png","resources/goo.gl-stock-b.png","resources/news-frontpage.png","resources/news-article.png","resources/pants-hemming-srp.png","resources/pants-srp.png"],f=0;const at=document.body??a(),lt=document.getElementById("scrim")??a(),qt=document.getElementById("globalProgress")??a(),ct=document.getElementById("attributedProgress")??a(),R=document.getElementById("networkDelayInput")??a(),Bt=document.getElementById("networkDelayDisplay")??a(),xt=document.getElementById("zoomDisplay")??a(),At=document.getElementById("buttonTest")??a(),Lt=document.getElementById("buttonSettings")??a(),mt=document.getElementById("settingsPanel")??a(),ft=document.getElementById("screenshots")??a(),Mt=document.getElementById("targetStopDisplay")??a();var nt;const ut=((nt=document.getElementById("frontimg"))==null?void 0:nt.querySelector("img"))??a();var st;const H=((st=document.getElementById("midimg"))==null?void 0:st.querySelector("img"))??a();var ot;const V=((ot=document.getElementById("backimg"))==null?void 0:ot.querySelector("img"))??a(),_=document.getElementById("settingZoom")??a(),dt=document.getElementById("settingProgressAttribution")??a(),Nt=document.getElementById("settingUnloadHandler")??a(),Tt=document.getElementById("settingBoostVelocity")??a(),U=document.getElementById("settingTargetStop")??a();let b=ct,I=b.querySelector(".bar"),kt="lightblue",u=0,j=0,M=0,Ct=["P25","P50","P75","P90","P95","P99"],Z=[30,100,330,660,1e3,2360],S=1,T=1;function Ht(){return Z[parseInt(R.value)]*2}function Vt(n){var t;((t=n.target)==null?void 0:t.classList[0])!="screenshot"||N||(x=!0,E=G())}function pt(n){return .3+(1-n/document.documentElement.getBoundingClientRect().width)*.5}let q=!1;function _t(n){if(!x)return;let t=E.pointerMove(n);console.log(t),document.documentElement.style.setProperty("--fg-offset",`${t.fgOffset}px`),document.documentElement.style.setProperty("--bg-offset",`${t.bgOffset}px`),document.documentElement.style.setProperty("--scrim",`${pt(t.fgOffset)}`),gt(t.fgOffset),$t(t.fgOffset)}function gt(n){let t=n/document.documentElement.getBoundingClientRect().width,e=1-(1-T)*t;document.documentElement.style.setProperty("--fg-scale",`${e}`)}function $t(n){if(n/document.documentElement.getBoundingClientRect().width>.5){if(!q){let e=document.documentElement.animate([{"--bg-scale":T}],{duration:100,fill:"forwards"});e.finished.then(()=>{e.commitStyles(),e.cancel()}),q=!0}}else if(q){let e=document.documentElement.animate([{"--bg-scale":S}],{duration:100,fill:"forwards"});e.finished.then(()=>{e.commitStyles(),e.cancel()}),q=!1}}function Ut(n){if(!x)return;if(x=!1,C=!1,E.pointerUp(n)=="abort")X(),A=!0;else if(Nt.checked){let e=document.documentElement.style.getPropertyValue("--fg-offset"),o=document.documentElement.style.getPropertyValue("--fg-scale"),s=document.documentElement.getBoundingClientRect().width*10/100,i=document.documentElement.animate([{"--fg-scale":1,"--fg-offset":s+"px"}],{duration:300,fill:"forwards"});i.finished.then(()=>{if(i.commitStyles(),i.cancel(),window.confirm("are you sure you want to leave this page?  It's very nice.")){let l=document.documentElement.animate([{"--fg-scale":o,"--fg-offset":e}],{duration:200,fill:"forwards"});l.finished.then(()=>{l.commitStyles(),l.cancel(),X(),et().then(tt)})}});return}et().then(tt)}function Zt(){let n=document.documentElement.animate([{"--fg-scale":T,"--bg-scale":1}],{duration:100,fill:"forwards"});n.finished.then(()=>{n.commitStyles(),n.cancel()})}function X(){let n=document.documentElement.animate([{"--fg-scale":1,"--bg-scale":S}],{duration:100,fill:"forwards"});n.finished.then(()=>{n.commitStyles(),n.cancel()})}function tt(){$=!0,document.documentElement.animate([{"--scrim":0}],{duration:100}).finished.then(bt),L=!A,L?ht():z()}function ht(){let n=performance.now();if(n>=M){z();return}b.style.display="block",I.max=M-u,I.value=n-u,requestAnimationFrame(ht)}let E=G();Et();function yt(n,t){const e=E.advance(n);document.documentElement.style.setProperty("--fg-offset",`${e.fgOffset}px`),document.documentElement.style.setProperty("--bg-offset",`${e.bgOffset}px`);const s=pt(e.fgOffset)+.1*Math.sin((n-u)/200);document.documentElement.style.setProperty("--scrim",`${s}`),gt(e.fgOffset),n-u>800&&(b.style.display="block"),e.hasCommitted&&!C&&(Zt(),C=!0),e.done?t():requestAnimationFrame(i=>{yt(i,t)})}function et(){return N=!0,u=performance.now(),j=u+parseFloat(R.value),M=u+Ht(),console.log("start : "+u+" commit : "+j+" load : "+M),E.startAnimating(u),new Promise(n=>{yt(performance.now(),n)})}function bt(){$=!1,document.documentElement.style.setProperty("--fg-offset","0px"),document.documentElement.style.setProperty("--vertical-offset","0px"),document.documentElement.style.setProperty("--scrim","0.0"),document.documentElement.style.setProperty("--bg-scale",S.toString()),document.documentElement.style.setProperty("--fg-scale","1.0"),A?(document.documentElement.style.setProperty("--main-background-color",kt),A=!1):zt(),L||(N=!1)}function z(){L=!1,b.style.display="none",I.removeAttribute("value"),I.removeAttribute("max"),$||(N=!1)}function Et(){bt(),z()}function G(){return new Ft({networkDelay:Z[parseInt(R.value)],targetOffset:document.documentElement.getBoundingClientRect().width,parallax:!0,limitFingerDrag:!0,boostVelocity:!!Tt.checked,targetStopPercent:parseFloat(U.value)})}function B(){let n=parseInt(R.value);Bt.innerHTML=Ct[n]+"="+Z[n].toString(),S=parseInt(_.value)/100,T=S+(1-S)/3,xt.innerHTML=_.value.toString(),Mt.innerHTML=`${100*parseFloat(U.value)}`,E.updateDisplays(),E=G(),Et()}function zt(){ut.src=H.src,H.src=V.src,V.src=g[f],f=(f+1)%g.length}function Gt(){mt.style.display="none",lt.style.display="block",ft.style.display="block",at.classList.add("test")}function Kt(){mt.style.display="flex",lt.style.display="none",ft.style.display="none",at.classList.remove("test")}function Jt(){dt.checked?b=ct:b=qt,I=b.querySelector(".bar")}function Qt(){R.addEventListener("input",B),_.addEventListener("input",B),U.addEventListener("input",B),At.addEventListener("click",Gt),Lt.addEventListener("click",Kt),ut.src=g[f],f=(f+1)%g.length,H.src=g[f],f=(f+1)%g.length,V.src=g[f],f=(f+1)%g.length,dt.addEventListener("change",Jt),B(),window.addEventListener("pointerdown",Vt),window.addEventListener("pointerup",Ut),window.addEventListener("pointermove",_t)}onload=Qt;
