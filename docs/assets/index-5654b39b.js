var U=Object.defineProperty;var G=(n,t,e)=>t in n?U(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var a=(n,t,e)=>(G(n,typeof t!="symbol"?t+"":t,e),e),b=(n,t,e)=>{if(!t.has(n))throw TypeError("Cannot "+e)};var f=(n,t,e)=>(b(n,t,"read from private field"),e?e.call(n):t.get(n)),w=(n,t,e)=>{if(t.has(n))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(n):t.set(n,e)},v=(n,t,e,i)=>(b(n,t,"write to private field"),i?i.call(n,e):t.set(n,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function e(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=e(s);fetch(s.href,o)}})();class ${constructor(t){a(this,"animationStartTime",0);a(this,"animationStartOffset",0);a(this,"networkDelay");a(this,"maxOffset");a(this,"offset",0);this.networkDelay=t.networkDelay,this.maxOffset=t.targetOffset}startAnimating(t){this.animationStartTime=t,this.animationStartOffset=this.offset}pointerUp(t){}committed(){return performance.now()-this.animationStartTime>=this.networkDelay}}function Y(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var V={exports:{}};(function(n){(function(){n.exports=t;function t(e,i,s,o){typeof s=="object"&&(o=s,s=!1),typeof o>"u"&&(o={});for(var r=0,m=0,g=0,d=0,l=e.length,u=0;u<l;++u)r+=e[u],m+=i[u],g+=e[u]*i[u],d+=e[u]*e[u];if(o.m=(g-r*m/l)/(d-r*r/l),o.b=m/l-o.m*r/l,s){for(var I=0,y=0;y<l;++y)I+=(i[y]-o.b-o.m*e[y])*(i[y]-o.b-o.m*e[y]);var L=l*d-r*r,A=1/(l-2)*I;o.bErr=Math.sqrt(A/L*d),o.mErr=Math.sqrt(l/L*A)}return function(B){return o.m*B+o.b}}})()})(V);var K=V.exports;const Z=Y(K);function q(){throw new Error("missing element")}function _(n){let t={m:0};const e=n.map(s=>s.offset),i=n.map(s=>s.time);return Z(i,e,!1,t),t.m,console.log(n),console.log(t),t.m}const x=10,z=10;class R{constructor(t){a(this,"mass",1);a(this,"initialVelocity",0);a(this,"dampingRatio");a(this,"undampedNaturalFrequency");a(this,"dampedNaturalFrequency");a(this,"lastNFrames");a(this,"name");const e=(2*Math.PI/t.frequencyResponse)**2*this.mass;this.undampedNaturalFrequency=Math.sqrt(e/this.mass),this.dampedNaturalFrequency=this.undampedNaturalFrequency*Math.sqrt(Math.abs(1-t.dampingRatio**2)),this.dampingRatio=t.dampingRatio,this.lastNFrames=[],this.name=t.name}position(t,e){console.log("Start position: "+t),console.log("Time: "+e);const i=this.undampedNaturalFrequency*this.dampingRatio,s=this.dampedNaturalFrequency,o=(this.initialVelocity+i*t)/s,r=t,m=Math.exp(-i*e)*(o*Math.sin(s*e)+r*Math.cos(s*e));if(isNaN(m)||!isFinite(m))throw"Spring config invalid. Position: "+m;this.lastNFrames.push({offset:m,time:e});let g=!1;if(this.lastNFrames.length>x){this.lastNFrames.shift();let d=0;for(let l of this.lastNFrames)d+=l.offset*l.offset;g=d<z*x}return{offset:m,done:g}}velocity(){return _(this.lastNFrames)}}var p,c,E;class J extends ${constructor(e){super(e);w(this,p,void 0);w(this,c,void 0);w(this,E,void 0);a(this,"lastRaf",null);a(this,"hasCommitted",!1);a(this,"pointerHistory",[]);this.animationStartOffset=this.animationStartTime,v(this,p,new R({frequencyResponse:1e3,dampingRatio:.95,name:"100%"})),v(this,c,new R({frequencyResponse:1200,dampingRatio:.7,name:"80%"})),v(this,E,new R({frequencyResponse:1e3,dampingRatio:.95,name:"0%"}))}updateDisplays(){}advance(e){e=e,!this.hasCommitted&&this.committed()&&(this.startAnimating(this.lastRaf||e),this.hasCommitted=!0,f(this,p).initialVelocity=f(this,c).velocity(),console.log("VELOCITY HANDOFF: "+f(this,c).velocity()));const i=e-this.animationStartTime;let s=null;return this.hasCommitted?(console.log(f(this,p)),s=f(this,p).position(this.maxOffset-this.animationStartOffset,i),this.offset=this.maxOffset-s.offset):(s=f(this,c).position(this.maxOffset*.8-this.animationStartOffset,i),console.log(f(this,c)),this.offset=this.maxOffset*.8-s.offset),console.log("Offset "+this.offset),this.lastRaf=e,{done:s.done&&this.hasCommitted,offset:this.offset}}pointerMove(e){return this.offset+=e.movementX,this.pointerHistory.push({offset:this.offset,time:e.timeStamp}),this.offset<0&&(this.offset=0),this.offset}pointerUp(e){f(this,c).initialVelocity=-_(this.pointerHistory),console.log("STARTING VELOCITY: "+f(this,c).initialVelocity)}}p=new WeakMap,c=new WeakMap,E=new WeakMap;let Q=J,O,T,P=!1,S=!1;const k=document.getElementById("scrim")??q(),F=document.getElementById("networkDelayInput")??q(),H=Array.from(document.querySelectorAll('input[name="mode"]')).map(n=>n),W=document.getElementById("networkDelayDisplay")??q();function j(n){var t;((t=n.target)==null?void 0:t.id)!=""||P||(S=!0,h=M(),T=document.startViewTransition(),T.ready.then(()=>{O=document.documentElement.animate({},{duration:100,pseudoElement:"::view-transition-new(root)"}),O.pause(),k.style.display="block"}))}function X(n){if(!S)return;let t=h.pointerMove(n);document.documentElement.style.setProperty("--offset",`${t}px`);let i=.3+(1-t/document.documentElement.getBoundingClientRect().width)*.5;document.documentElement.style.setProperty("--scrim",`${i}`)}function tt(n){S&&(S=!1,h.pointerUp(n),et().then(()=>{document.documentElement.animate([{"--scrim":0}],{duration:100}).finished.then(D)}))}let h=M();D();function C(n,t){const e=h.advance(n);console.log(e),document.documentElement.style.setProperty("--offset",`${e.offset}px`),e.done?t():requestAnimationFrame(i=>{C(i,t)})}function et(){return P=!0,h.startAnimating(performance.now()),new Promise(n=>{C(performance.now(),n)})}function D(){P=!1,document.documentElement.style.setProperty("--offset","0px"),document.documentElement.style.setProperty("--vertical-offset","0px"),document.documentElement.style.setProperty("--scrim","0.0"),O&&O.play(),k.style.display="none"}function M(){for(const n of H)n.checked&&parseInt(n.value);return new Q({dragStartTime:performance.now(),networkDelay:parseFloat(F.value),targetOffset:document.documentElement.getBoundingClientRect().width})}function N(){W.innerHTML=F.value,h.updateDisplays(),h=M(),D()}function nt(){F.addEventListener("input",N);for(const n of H)n.addEventListener("click",N);N(),window.addEventListener("pointerdown",j),window.addEventListener("pointerup",tt),window.addEventListener("pointermove",X)}onload=nt;
