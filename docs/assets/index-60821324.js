var It=Object.defineProperty;var Dt=(n,e,t)=>e in n?It(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var a=(n,e,t)=>(Dt(n,typeof e!="symbol"?e+"":e,t),t),Y=(n,e,t)=>{if(!e.has(n))throw TypeError("Cannot "+t)};var f=(n,e,t)=>(Y(n,e,"read from private field"),t?t.call(n):e.get(n)),F=(n,e,t)=>{if(e.has(n))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(n):e.set(n,t)},k=(n,e,t,o)=>(Y(n,e,"write to private field"),o?o.call(n,t):e.set(n,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();class Ot{constructor(e){a(this,"animationStartTime",0);a(this,"animationStartOffset",0);a(this,"networkDelay");a(this,"maxOffset");a(this,"offset",0);a(this,"parallax");a(this,"limitFingerDrag");a(this,"boostVelocity");a(this,"targetStopPercent");a(this,"loadStart",0);this.networkDelay=e.networkDelay,this.maxOffset=e.targetOffset,this.parallax=e.parallax,this.limitFingerDrag=e.limitFingerDrag,this.boostVelocity=e.boostVelocity,this.targetStopPercent=e.targetStopPercent}startAnimating(e){this.loadStart=e,this.animationStartTime=e,this.animationStartOffset=this.offset}restartAnimating(e){this.animationStartTime=e,this.animationStartOffset=this.offset}pointerUp(e){return"success"}committed(e){return e-this.loadStart>=this.networkDelay}}function Rt(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var at={exports:{}};(function(n){(function(){n.exports=e;function e(t,o,s,i){typeof s=="object"&&(i=s,s=!1),typeof i>"u"&&(i={});for(var l=0,c=0,S=0,v=0,m=t.length,g=0;g<m;++g)l+=t[g],c+=o[g],S+=t[g]*o[g],v+=t[g]*t[g];if(i.m=(S-l*c/m)/(v-l*l/m),i.b=c/m-i.m*l/m,s){for(var W=0,I=0;I<m;++I)W+=(o[I]-i.b-i.m*t[I])*(o[I]-i.b-i.m*t[I]);var J=m*v-l*l,Q=1/(m-2)*W;i.bErr=Math.sqrt(Q/J*v),i.mErr=Math.sqrt(m/J*Q)}return function(St){return i.m*St+i.b}}})()})(at);var wt=at.exports;const Ft=Rt(wt);function r(){throw new Error("missing element")}function rt(n){let e={m:0};const t=n.map(s=>s.offset),o=n.map(s=>s.time);return Ft(o,t,!1,e),e.m,e.m}const j=10,kt=10;class _{constructor(e){a(this,"mass",1);a(this,"initialVelocity",0);a(this,"dampingRatio");a(this,"undampedNaturalFrequency");a(this,"dampedNaturalFrequency");a(this,"lastNFrames");a(this,"name");a(this,"overshootCurve",e=>e);const t=(2*Math.PI/e.frequencyResponse)**2*this.mass;this.undampedNaturalFrequency=Math.sqrt(t/this.mass),this.dampedNaturalFrequency=this.undampedNaturalFrequency*Math.sqrt(Math.abs(1-e.dampingRatio**2)),this.dampingRatio=e.dampingRatio,this.lastNFrames=[],this.name=e.name,e.overshootCurve&&(this.overshootCurve=e.overshootCurve)}position(e,t){const o=this.undampedNaturalFrequency*this.dampingRatio,s=this.dampedNaturalFrequency,i=(this.initialVelocity+o*e)/s,l=e;let c=Math.exp(-o*t)*(i*Math.sin(s*t)+l*Math.cos(s*t));if(c<0&&(c=this.overshootCurve(c)),isNaN(c)||!isFinite(c))throw"Spring config invalid. Position: "+c;this.lastNFrames.push({offset:c,time:t});let S=!1;if(this.lastNFrames.length>j){this.lastNFrames.shift();let v=0;for(let m of this.lastNFrames)v+=m.offset*m.offset;S=v<kt*j}return c<1&&(S=!0),{offset:c,done:S}}velocity(){return rt(this.lastNFrames)}}var E,d,O;class Bt extends Ot{constructor(t){super(t);F(this,E,void 0);F(this,d,void 0);F(this,O,void 0);a(this,"lastRaf",null);a(this,"hasCommitted",!1);a(this,"hasAborted",!1);a(this,"pointerHistory",[]);a(this,"spring80FrequencyResponseInput",document.getElementById("spring80FrequencyResponse")??r());a(this,"spring80FrequencyResponseDisplay",document.getElementById("spring80FrequencyResponseDisplay")??r());a(this,"spring80DampingRatioInput",document.getElementById("spring80DampingRatio")??r());a(this,"spring80DampingRatioDisplay",document.getElementById("spring80DampingRatioDisplay")??r());a(this,"hookAtInput",document.getElementById("hookAt")??r());a(this,"hookAtDisplay",document.getElementById("hookAtDisplay")??r());a(this,"spring80FrequencyResponse",parseFloat(this.spring80FrequencyResponseInput.value));a(this,"spring80DampingRatio",parseFloat(this.spring80DampingRatioInput.value));a(this,"hookAtPercent",parseFloat(this.hookAtInput.value));a(this,"hooked",!1);this.animationStartOffset=0,this.spring80FrequencyResponseInput.addEventListener("input",()=>this.updateDisplays()),this.spring80DampingRatioInput.addEventListener("input",()=>this.updateDisplays()),this.hookAtInput.addEventListener("input",()=>this.updateDisplays()),k(this,E,new _({frequencyResponse:200,dampingRatio:.95,name:"100%"})),k(this,d,new _({frequencyResponse:this.spring80FrequencyResponse,dampingRatio:this.spring80DampingRatio,name:"80%"})),k(this,O,new _({frequencyResponse:200,dampingRatio:.9,name:"0%"}))}updateDisplays(){this.spring80FrequencyResponseDisplay.innerHTML=this.spring80FrequencyResponseInput.value,this.spring80DampingRatioDisplay.innerHTML=this.spring80DampingRatioInput.value,this.hookAtDisplay.innerHTML=this.hookAtInput.value}advance(t){t=t;const o=t-this.animationStartTime;let s=null;this.hooked?this.hasAborted?(s=f(this,O).position(this.animationStartOffset,o),this.offset=Math.max(s.offset,0)):this.hasCommitted?(s=f(this,E).position(this.maxOffset-this.animationStartOffset,o),this.offset=this.maxOffset-s.offset):(s=f(this,d).position(this.maxOffset*this.targetStopPercent-this.animationStartOffset,o),this.offset=this.maxOffset*this.targetStopPercent-s.offset):this.offset=this.animationStartOffset-o*f(this,d).initialVelocity,!this.hasCommitted&&this.committed(t)&&(this.startAnimating(this.lastRaf||t),this.hasCommitted=!0,this.hooked?f(this,E).initialVelocity=f(this,d).velocity():(this.hooked=!0,f(this,E).initialVelocity=f(this,d).initialVelocity)),!this.hooked&&this.offset>this.maxOffset*this.hookAtPercent/100&&(this.restartAnimating(this.lastRaf||t),this.hooked=!0,this.animationStartOffset=this.offset);let i=s?s.done:!1;return this.lastRaf=t,{done:i&&(this.hasCommitted||this.hasAborted),fgOffset:this.offset,bgOffset:this.fgToBgOffset(this.offset),hasCommitted:this.hasCommitted}}pointerMove(t){return this.offset=this.fingerDragAdd(this.offset,t.movementX),this.pointerHistory.push({offset:this.offset,time:t.timeStamp}),this.pointerHistory.length>10&&this.pointerHistory.shift(),this.offset<0&&(this.offset=0),{done:!1,fgOffset:this.offset,bgOffset:this.fgToBgOffset(this.offset),hasCommitted:!1}}fingerDragAdd(t,o){return this.limitFingerDrag?t+this.targetStopPercent*o:t+o}fgToBgOffset(t){return this.parallax?.25*(t-this.maxOffset):0}setDefaultVelocity(){this.offset=this.maxOffset/4,f(this,d).initialVelocity=this.boostVelocity?-2:-1}pointerUp(t){let o=rt(this.pointerHistory);return console.log("before: "+o),this.boostVelocity&&(o*=4,o=Math.max(o,1)),console.log("post boost: "+o),o=Math.min(o,2),console.log("post clamp: "+o),(this.offset+o*100)/this.maxOffset<.3||o<-.1?(this.hasAborted=!0,f(this,O).initialVelocity=-o,"abort"):(f(this,d).initialVelocity=-o,"success")}}E=new WeakMap,d=new WeakMap,O=new WeakMap;let T=!1,A=!1,q=!1,$=!1,L=!1,G=!1,y=["resources/srp-cats.png","resources/srp-couches.png","resources/banana-pie-srp.png","resources/goo.gl-stock-a.png","resources/goo.gl-stock-b.png","resources/news-frontpage.png","resources/news-article.png","resources/pants-hemming-srp.png","resources/pants-srp.png"],u=0;const lt=document.body??r(),ct=document.getElementById("scrim")??r(),At=document.getElementById("globalProgress")??r(),mt=document.getElementById("attributedProgress")??r(),R=document.getElementById("networkDelayInput")??r(),qt=document.getElementById("networkDelayDisplay")??r(),Lt=document.getElementById("zoomDisplay")??r(),xt=document.getElementById("buttonTest")??r(),Mt=document.getElementById("buttonSettings")??r(),ft=document.getElementById("settingsPanel")??r(),ut=document.getElementById("screenshots")??r(),Tt=document.getElementById("targetStopDisplay")??r();var st;const x=((st=document.getElementById("frontimg"))==null?void 0:st.querySelector("img"))??r();var ot;const U=((ot=document.getElementById("midimg"))==null?void 0:ot.querySelector("img"))??r();var it;const Z=((it=document.getElementById("backimg"))==null?void 0:it.querySelector("img"))??r(),z=document.getElementById("settingZoom")??r(),dt=document.getElementById("settingProgressAttribution")??r(),Ct=document.getElementById("settingUnloadHandler")??r(),pt=document.getElementById("settingBoostVelocity")??r(),C=document.getElementById("settingTargetStop")??r(),Nt=document.getElementById("settingFadeForeground")??r();let b=mt,w=b.querySelector(".bar"),Vt="lightblue",p=0,X=0,M=0,Ht=["P25","P50","P75","P90","P95","P99"],N=[30,100,330,660,1e3,2360],D=1,V=1;function _t(){return N[parseInt(R.value)]*2}function $t(n){var e;((e=n.target)==null?void 0:e.classList[0])!="screenshot"||T||(A=!0,P=H())}function gt(n){return .3+(1-n)*.5}let B=!1;function Ut(n){if(!A)return;let e=P.pointerMove(n);console.log(e);let t=e.fgOffset/document.documentElement.getBoundingClientRect().width;document.documentElement.style.setProperty("--fg-offset",`${e.fgOffset}px`),document.documentElement.style.setProperty("--bg-offset",`${e.bgOffset}px`),document.documentElement.style.setProperty("--scrim",`${gt(t)}`),Pt(t),ht(e.fgOffset),Zt(e.fgOffset)}function ht(n){let e=n/document.documentElement.getBoundingClientRect().width,t=1-(1-V)*e;document.documentElement.style.setProperty("--fg-scale",`${t}`)}function Zt(n){if(n/document.documentElement.getBoundingClientRect().width>.5){if(!B){let t=document.documentElement.animate([{"--bg-scale":V}],{duration:100,fill:"forwards"});t.finished.then(()=>{t.commitStyles(),t.cancel()}),B=!0}}else if(B){let t=document.documentElement.animate([{"--bg-scale":D}],{duration:100,fill:"forwards"});t.finished.then(()=>{t.commitStyles(),t.cancel()}),B=!1}}function zt(n){if(!A)return;if(A=!1,$=!1,P.pointerUp(n)=="abort")tt(),q=!0;else if(Ct.checked){let t=document.documentElement.style.getPropertyValue("--fg-offset"),o=document.documentElement.style.getPropertyValue("--fg-scale"),s=document.documentElement.getBoundingClientRect().width*10/100,i=document.documentElement.animate([{"--fg-scale":1,"--fg-offset":s+"px"}],{duration:300,fill:"forwards"});i.finished.then(()=>{if(i.commitStyles(),i.cancel(),window.confirm("are you sure you want to leave this page?  It's very nice.")){let l=document.documentElement.animate([{"--fg-scale":o,"--fg-offset":t}],{duration:200,fill:"forwards"});l.finished.then(()=>{l.commitStyles(),l.cancel(),tt(),nt().then(et)})}});return}nt().then(et)}function Gt(){let n=document.documentElement.animate([{"--fg-scale":V,"--bg-scale":1}],{duration:100,fill:"forwards"});n.finished.then(()=>{n.commitStyles(),n.cancel()})}function tt(){let n=document.documentElement.animate([{"--fg-scale":1,"--bg-scale":D}],{duration:100,fill:"forwards"});n.finished.then(()=>{n.commitStyles(),n.cancel()})}function et(){G=!0,document.documentElement.animate([{"--scrim":0}],{duration:100}).finished.then(Et),L=!q,L?yt():K()}function yt(){let n=performance.now();if(n>=M){K();return}b.style.display="block",w.max=M-p,w.value=n-p,requestAnimationFrame(yt)}let P=H();bt();function vt(n,e){const t=P.advance(n);document.documentElement.style.setProperty("--fg-offset",`${t.fgOffset}px`),document.documentElement.style.setProperty("--bg-offset",`${t.bgOffset}px`);let o=t.fgOffset/document.documentElement.getBoundingClientRect().width;const s=gt(o);Pt(o);const i=s+.1*Math.sin((n-p)/200);document.documentElement.style.setProperty("--scrim",`${i}`),ht(t.fgOffset),n-p>800&&(b.style.display="block"),t.hasCommitted&&!$&&(Gt(),$=!0),t.done?e():requestAnimationFrame(l=>{vt(l,e)})}function nt(){return T=!0,p=performance.now(),X=p+parseFloat(R.value),M=p+_t(),console.log("start : "+p+" commit : "+X+" load : "+M),P.startAnimating(p),new Promise(n=>{vt(performance.now(),n)})}function Et(){G=!1,document.documentElement.style.setProperty("--fg-offset","0px"),document.documentElement.style.setProperty("--vertical-offset","0px"),document.documentElement.style.setProperty("--scrim","0.0"),document.documentElement.style.setProperty("--bg-scale",D.toString()),document.documentElement.style.setProperty("--fg-scale","1.0"),q?(document.documentElement.style.setProperty("--main-background-color",Vt),q=!1):Wt(),L||(T=!1)}function K(){L=!1,b.style.display="none",w.removeAttribute("value"),w.removeAttribute("max"),G||(T=!1)}function bt(){Et(),K()}function H(){return new Bt({networkDelay:N[parseInt(R.value)],targetOffset:document.documentElement.getBoundingClientRect().width,parallax:!0,limitFingerDrag:!0,boostVelocity:!!pt.checked,targetStopPercent:parseFloat(C.value)})}function Kt(){let n=document.documentElement.getBoundingClientRect().width,e=H();e.setDefaultVelocity(),e.startAnimating(0);var t=document.getElementById("plot")??r();let o=t.width/1e3;t.height=n*o;var s=t.getContext("2d");if(!s)return;s.scale(o,o),s.lineWidth=3,s.strokeStyle="black",s.beginPath(),s.moveTo(0,0);for(var i=0;i<1e3;i++)s.lineTo(i,e.advance(i).fgOffset);s.stroke(),s.strokeStyle="red";let l=n*parseFloat(C.value);s.beginPath(),s.moveTo(0,l),s.lineTo(1e3,l),s.stroke(),s.strokeStyle="green";let c=N[parseInt(R.value)];s.beginPath(),s.moveTo(c,0),s.lineTo(c,n),s.stroke()}function h(){let n=parseInt(R.value);qt.innerHTML=Ht[n]+"="+N[n].toString(),D=parseInt(z.value)/100,V=D+(1-D)/3,Lt.innerHTML=z.value.toString(),Tt.innerHTML=`${100*parseFloat(C.value)}`,P.updateDisplays(),Kt(),P=H(),bt()}function Pt(n){Nt.checked&&(x.style.filter=`grayscale(${n})`)}function Wt(){x.style.filter="",x.src=U.src,U.src=Z.src,Z.src=y[u],u=(u+1)%y.length}function Jt(){ft.style.display="none",ct.style.display="block",ut.style.display="block",lt.classList.add("test")}function Qt(){ft.style.display="flex",ct.style.display="none",ut.style.display="none",lt.classList.remove("test")}function Yt(){dt.checked?b=mt:b=At,w=b.querySelector(".bar")}function jt(){R.addEventListener("input",h),z.addEventListener("input",h),C.addEventListener("input",h),pt.addEventListener("input",h);let n=document.getElementById("spring80FrequencyResponse")??r(),e=document.getElementById("spring80DampingRatio")??r(),t=document.getElementById("hookAt")??r();n.addEventListener("input",h),e.addEventListener("input",h),t.addEventListener("input",h),xt.addEventListener("click",Jt),Mt.addEventListener("click",Qt),x.src=y[u],u=(u+1)%y.length,U.src=y[u],u=(u+1)%y.length,Z.src=y[u],u=(u+1)%y.length,dt.addEventListener("change",Yt),h(),window.addEventListener("pointerdown",$t),window.addEventListener("pointerup",zt),window.addEventListener("pointermove",Ut)}onload=jt;
